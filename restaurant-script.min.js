const isLocalDev=["localhost","127.0.0.1"].includes(window.location.hostname),API_BASE_URL=isLocalDev?"/api":"https://api.acoomh.ro";let currentLocation=null;function createLoadingOverlay(){const e=document.createElement("div");return e.className="page-loading-overlay",e.id="pageLoadingOverlay",e.innerHTML='\n    <div class="loading-spinner-container">\n      <div class="modern-loading-spinner"></div>\n      <div class="loading-text">\n        Se încarcă<span class="loading-dots"></span>\n      </div>\n    </div>\n  ',document.body.appendChild(e),e}function showLoadingOverlay(){document.body.classList.add("loading"),document.body.classList.remove("loaded");let e=document.getElementById("pageLoadingOverlay");e||(e=createLoadingOverlay()),e.classList.remove("hidden")}function hideLoadingOverlay(){const e=document.getElementById("pageLoadingOverlay");e&&(e.style.transition="opacity 0.5s ease, visibility 0.5s ease",e.style.opacity="0",e.style.visibility="hidden",e.style.pointerEvents="none",setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},500)),document.body.classList.remove("loading"),document.body.classList.add("loaded")}function navigateWithLoading(e){clearTimeout(window.loadingTimeout),showLoadingOverlay(),window.location.href=e}async function loadLocationDetails(e){try{const t=await fetch(`${API_BASE_URL}/locations/${e}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();currentLocation=n,populateLocationDetails(n),await loadLocationHours(e),console.log("✅ Successfully loaded location details:",n),setTimeout(()=>{hideLoadingOverlay(),setTimeout(()=>{document.body.classList.add("loaded")},100)},500)}catch(e){console.error("Error loading location details:",e),showError(`Nu am putut încărca datele restaurantului. ${e.message}`),hideLoadingOverlay()}}async function loadLocationHours(e){try{const t=await fetch(`${API_BASE_URL}/locations/${e}/hours`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(t.ok){const e=await t.json();currentLocation.hours=e,console.log("✅ Successfully loaded location hours:",e);const n=document.getElementById("reservationDate");n&&n.value&&populateTimeSlots(n.value)}else console.log("No hours data available for this location"),currentLocation.hours=[]}catch(e){console.log("Could not load location hours:",e),currentLocation.hours=[]}}async function createReservation(e){try{const t=new FormData;t.append("customerName",e.customerName),t.append("customerEmail",e.customerEmail),t.append("customerPhone",e.customerPhone),t.append("reservationDate",e.reservationDate),t.append("reservationTime",e.reservationTime),t.append("numberOfPeople",e.numberOfPeople.toString()),t.append("locationId",e.locationId.toString()),t.append("specialRequests",e.specialRequests||""),e.userId&&t.append("userId",e.userId.toString());const n=await fetch(`${API_BASE_URL}/reservation`,{method:"POST",body:t});if(!n.ok){const e=await n.text();let t="A apărut o eroare la crearea rezervării.";try{t=JSON.parse(e).message||t}catch{e.length<200&&(t=e)}throw new Error(t)}const a=await n.json();return console.log("✅ Successfully created reservation:",a),a}catch(e){throw console.error("Error creating reservation:",e),e}}function getLocationId(){return new URLSearchParams(window.location.search).get("id")}function showLoadingState(){document.body.classList.add("loading")}function hideLoadingState(){document.body.classList.remove("loading")}function showError(e){showPopup("Eroare",e,"fas fa-exclamation-triangle")}function populateLocationDetails(e){document.getElementById("restaurantName").textContent=e.Name||e.name||"Restaurant",document.getElementById("restaurantAddress").textContent=e.Address||e.address||"Adresă necunoscută",document.getElementById("restaurantCuisine").textContent=e.Category||e.category||"Restaurant";const t=e.Description||e.description||`Descoperă ${e.Name||e.name||"acest loc"}, un loc minunat cu o atmosferă unică și o experiență de neuitat. Situat în ${e.Address||e.address||"oraș"}, oferim servicii de calitate și o experiență plăcută pentru toți vizitatorii.`;document.getElementById("restaurantDescription").textContent=t;const n=document.getElementById("restaurantImage");if(e.photoUrl)n.src=e.photoUrl,n.onerror=()=>setDefaultImage(n,e.Category||e.category);else{const t=e.Photo||e.photo;if(t)try{let a;if("string"==typeof t)a="use_photo_url"===t?e.photoUrl:t.startsWith("data:")||t.startsWith("http")?t:`data:image/jpeg;base64,${t}`;else if(Array.isArray(t)&&t.length>0){a=`data:image/jpeg;base64,${btoa(String.fromCharCode.apply(null,t))}`}a?(n.src=a,n.onerror=()=>setDefaultImage(n,e.Category||e.category)):setDefaultImage(n,e.Category||e.category)}catch(t){console.error("Error processing image:",t),setDefaultImage(n,e.Category||e.category)}else setDefaultImage(n,e.Category||e.category)}n.alt=e.Name||e.name||"Restaurant";const a=document.getElementById("restaurantTags");a.innerHTML="";const o=e.category||e.Category||"Location";console.log(o+"test");const i=document.createElement("span");i.className="restaurant-tag primary";const s=getCategoryIcon(o),r=document.createElement("i");r.className=s,i.appendChild(r),i.appendChild(document.createTextNode(` ${o}`)),a.appendChild(i);const c=e.tags;if(c&&Array.isArray(c)&&c.length>0){const e=c.filter(e=>e&&e.trim().length>0);e.slice(0,4).forEach(e=>{const t=document.createElement("span");t.className="restaurant-tag",t.textContent=e,a.appendChild(t)}),console.log("✅ Tags processed from API:",e)}else console.log("ℹ️ No tags data available for this location");if(populateSchedule(e.hours),populateFeatures(e),e.Company&&e.Company.phone){const t=document.getElementById("restaurantPhone");t&&(t.textContent=e.Company.phone,t.href=`tel:${e.Company.phone.replace(/\s/g,"")}`)}else if(e.phone){const t=document.getElementById("restaurantPhone");t&&(t.textContent=e.phone,t.href=`tel:${e.phone.replace(/\s/g,"")}`)}else{const e=document.getElementById("restaurantPhone");if(e){const t=e.closest(".info-item");t&&(t.style.display="none")}}document.title=`${e.Name||e.name||"Restaurant"} - AcoomH`,console.log("✅ Location details populated successfully:",e)}function populateSchedule(e){const t=document.getElementById("restaurantSchedule");if(!t)return void console.warn("Schedule container not found");t.innerHTML="";const n=(new Date).getDay(),a=["Duminică","Luni","Marți","Miercuri","Joi","Vineri","Sâmbătă"],o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];if(console.log("Processing schedule with hours:",e),e&&Array.isArray(e)&&e.length>0)a.forEach((a,i)=>{const s=o[i],r=e.find(e=>e.DayOfWeek===a||e.DayOfWeek===s||e.dayOfWeek===a||e.dayOfWeek===s),c=document.createElement("div");c.className="schedule-item";const l=i===n;let u="Nedisponibil",d=!0;if(r)if(r.IsClosed||r.isClosed)u="Închis",d=!0;else if(r.OpenTime||r.openTime){u=`${r.OpenTime||r.openTime} - ${r.CloseTime||r.closeTime}`,d=!1}c.innerHTML=`\n        <span class="schedule-day">${a}</span>\n        <span class="schedule-hours ${d?"closed":""} ${l?"current-day":""}">${u}</span>\n      `,t.appendChild(c)}),console.log("✅ Schedule populated from API data");else{const e={Luni:"10:00 - 22:00","Marți":"10:00 - 22:00",Miercuri:"10:00 - 22:00",Joi:"10:00 - 22:00",Vineri:"10:00 - 23:00","Sâmbătă":"10:00 - 23:00","Duminică":"12:00 - 21:00"};Object.entries(e).forEach(([e,n],a)=>{const o=document.createElement("div");o.className="schedule-item",o.innerHTML=`\n        <span class="schedule-day">${e}</span>\n        <span class="schedule-hours">${n}</span>\n      `,t.appendChild(o)}),console.log("✅ Default schedule populated")}}function populateFeatures(e){const t=document.getElementById("restaurantFeatures");t.innerHTML="";[{icon:"fas fa-credit-card",name:"Plată cu cardul"},{icon:"fas fa-calendar-check",name:"Rezervări online"},...{restaurant:[{icon:"fas fa-utensils",name:"Meniu variat"},{icon:"fas fa-users",name:"Pentru grupuri"}],cafe:[{icon:"fas fa-wifi",name:"WiFi gratuit"},{icon:"fas fa-coffee",name:"Cafea proaspătă"}],cafenea:[{icon:"fas fa-wifi",name:"WiFi gratuit"},{icon:"fas fa-coffee",name:"Cafea proaspătă"}],pub:[{icon:"fas fa-beer",name:"Bere la halba"},{icon:"fas fa-tv",name:"Transmisiuni live"}],club:[{icon:"fas fa-music",name:"Muzică live"},{icon:"fas fa-cocktail",name:"Cocktailuri"}]}[e.category&&"string"==typeof e.category?e.category.toLowerCase():"restaurant"]||[]].forEach(e=>{const n=document.createElement("div");n.className="feature-item",n.innerHTML=`\n      <i class="${e.icon}"></i>\n      <span>${e.name}</span>\n    `,t.appendChild(n)})}function getCategoryIcon(e){if(!e||"string"!=typeof e)return"fas fa-store";return{restaurant:"fas fa-utensils",cafe:"fas fa-coffee",cafenea:"fas fa-coffee",pub:"fas fa-beer",club:"fas fa-music",bar:"fas fa-cocktail"}[e.toLowerCase()]||"fas fa-store"}function setDefaultImage(e,t){const n={restaurant:"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",cafe:"https://images.unsplash.com/photo-1501339847302-ac426a4a7cbb?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",cafenea:"https://images.unsplash.com/photo-1501339847302-ac426a4a7cbb?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",pub:"https://images.unsplash.com/photo-1572116469696-31de0f17cc34?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",club:"https://images.unsplash.com/photo-1571266028243-d220c9f3e821?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",bar:"https://images.unsplash.com/photo-1514362545857-3bc16c4c7d1b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"},a=t&&"string"==typeof t?t.toLowerCase():"restaurant";e.src=n[a]||n.restaurant}function arrayBufferToBase64(e){let t="";const n=new Uint8Array(e),a=n.byteLength;for(let e=0;e<a;e++)t+=String.fromCharCode(n[e]);return window.btoa(t)}function initializeReservationForm(){const e=document.getElementById("reservationDate"),t=(document.getElementById("reservationTime"),new Date),n=new Date;n.setDate(t.getDate()+30),e.min=t.toISOString().split("T")[0],e.max=n.toISOString().split("T")[0];const a=new Date;a.setDate(t.getDate()+1),e.value=a.toISOString().split("T")[0],e.addEventListener("change",function(){populateTimeSlots(this.value)}),populateTimeSlots(e.value)}function populateTimeSlots(e){const t=document.getElementById("reservationTime"),n=t.value;if(t.innerHTML='<option value="">Selectează ora</option>',!e||!currentLocation)return void generateDefaultTimeSlots(t);if(!currentLocation.hours||0===currentLocation.hours.length)return void generateDefaultTimeSlots(t);const a=new Date(e+"T00:00:00").getDay(),o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][a],i=["Duminică","Luni","Marți","Miercuri","Joi","Vineri","Sâmbătă"][a],s=currentLocation.hours.find(e=>e.DayOfWeek===i||e.DayOfWeek===o||e.dayOfWeek===i||e.dayOfWeek===o);if(!s||s.IsClosed||s.isClosed)return void generateDefaultTimeSlots(t);const r=s.OpenTime||s.openTime,c=s.CloseTime||s.closeTime;r&&c?(generateTimeSlots(t,r,c,e),n&&t.querySelector(`option[value="${n}"]`)&&(t.value=n)):generateDefaultTimeSlots(t)}function generateTimeSlots(e,t,n,a){const o=new Date,i=a===o.toISOString().split("T")[0],s=o.getHours(),r=o.getMinutes(),[c,l]=t.split(":").map(Number),[u,d]=n.split(":").map(Number);let m=c,p=l;const f=p%15;0!==f&&(p+=15-f,p>=60&&(p=0,m+=1));let g=u,y=d;for(y>=60?(g+=1,y-=60):(g-=1,y+=0);m<g||m===g&&p<=y;){if(i){if(60*m+p<60*s+r+60){p+=15,p>=60&&(p=0,m+=1);continue}}const t=`${m.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}`,n=document.createElement("option");n.value=t,n.textContent=t,e.appendChild(n),p+=15,p>=60&&(p=0,m+=1)}if(1===e.children.length){const t=document.createElement("option");t.value="",t.textContent=i?"Nu mai sunt ore disponibile astăzi":"Nu sunt ore disponibile",t.disabled=!0,e.appendChild(t)}}function generateDefaultTimeSlots(e){const t=new Date,n=document.getElementById("reservationDate").value===t.toISOString().split("T")[0],a=t.getHours(),o=t.getMinutes();["12:00","12:15","12:30","12:45","13:00","13:15","13:30","13:45","14:00","14:15","14:30","14:45","18:00","18:15","18:30","18:45","19:00","19:15","19:30","19:45","20:00","20:15","20:30","20:45","21:00","21:15","21:30","21:45"].forEach(t=>{if(n){const[e,n]=t.split(":").map(Number);if(60*e+n<60*a+o+60)return}const i=document.createElement("option");i.value=t,i.textContent=t,e.appendChild(i)})}function validateReservationForm(){const e=document.getElementById("fullName").value.trim(),t=document.getElementById("phoneNumber").value.trim(),n=document.getElementById("reservationDate").value,a=document.getElementById("reservationTime").value,o=document.getElementById("guestCount").value,i=[];if(e?e.length<2&&i.push("Numele trebuie să aibă cel puțin 2 caractere"):i.push("Introdu numele tău complet"),t?/^(\+4|4|0)?\d{9}$/.test(t.replace(/\s/g,""))||i.push("Numărul de telefon nu este valid (ex: 0721234567)"):i.push("Introdu numărul de telefon"),n){const e=new Date(n),t=new Date;t.setHours(0,0,0,0),e<t&&i.push("Data rezervării nu poate fi în trecut")}else i.push("Selectează o dată pentru rezervare");return a||i.push("Selectează ora pentru rezervare"),o||i.push("Selectează numărul de persoane"),{isValid:0===i.length,errors:i}}function showPopup(e,t,n="fas fa-info-circle",a=!1){document.querySelectorAll(".popup-overlay").forEach(e=>e.remove());const o=document.createElement("div");o.className="popup-overlay";const i=document.createElement("div");function closePopup(){o.style.opacity="0",i.style.transform="scale(0.8) translateY(20px)",setTimeout(()=>{document.body.contains(o)&&document.body.removeChild(o)},300)}i.className="popup-content",i.innerHTML=`\n    <div style="margin-bottom: 25px;">\n      <i class="${n}" style="font-size: 3rem; color: ${a?"var(--success-color)":"var(--primary-color)"}; margin-bottom: 20px; display: block;"></i>\n      <h3>${e}</h3>\n      <p>${t}</p>\n    </div>\n    <button class="popup-close-btn">\n      <i class="fas fa-check" style="margin-right: 8px;"></i>\n      Înțeles!\n    </button>\n  `,i.querySelector(".popup-close-btn").addEventListener("click",closePopup),o.addEventListener("click",e=>{e.target===o&&closePopup()});const escapeHandler=e=>{"Escape"===e.key&&(closePopup(),document.removeEventListener("keydown",escapeHandler))};document.addEventListener("keydown",escapeHandler),o.appendChild(i),document.body.appendChild(o),setTimeout(()=>{o.style.opacity="1",i.style.transform="scale(1) translateY(0)"},10)}function showMenuModal(){const e=document.getElementById("menuModalOverlay"),t=getCurrentRestaurant().name;document.getElementById("menuRestaurantName").textContent=`Meniu ${t}`,e.style.display="flex",setTimeout(()=>{e.classList.add("show")},10),document.body.style.overflow="hidden"}async function tryPdfMenuFallback(){try{const e=await fetch(`${API_BASE_URL}/locations/${currentLocation.id}/menu`,{method:"GET",headers:{Accept:"application/pdf,*/*"}});if(e.ok){const t=await e.blob();if(t.size>0)return void showPdfMenuOption(t)}}catch(e){console.log("PDF menu also not available:",e)}showMenuError()}function showPdfMenuOption(e){const t=document.getElementById("menuLoading"),n=document.getElementById("menuError"),a=document.getElementById("menuContent");t.style.display="none",n.style.display="none",a.style.display="flex";document.getElementById("menuItems").innerHTML='\n    <div class="pdf-menu-container">\n      <div class="pdf-menu-info">\n        <i class="fas fa-file-pdf"></i>\n        <h3>Meniu disponibil în format PDF</h3>\n        <p>Meniul acestui restaurant este disponibil ca document PDF.</p>\n        <button class="btn-download-pdf" onclick="downloadPdfMenu()">\n          <i class="fas fa-download"></i>\n          Descarcă meniul\n        </button>\n        <button class="btn-view-pdf" onclick="viewPdfMenu()">\n          <i class="fas fa-external-link-alt"></i>\n          Vezi în browser\n        </button>\n      </div>\n    </div>\n  ',window.currentMenuPdf=e,document.getElementById("menuCategories").style.display="none"}function displayMenuData(e){const t=document.getElementById("menuLoading"),n=document.getElementById("menuError"),a=document.getElementById("menuContent");t.style.display="none",n.style.display="none",a.style.display="flex";const o=organizeMenuByCategory(e);displayMenuCategories(Object.keys(o)),displayMenuItems(o)}function organizeMenuByCategory(e){const t={};return(Array.isArray(e)?e:e.items||[]).forEach(e=>{const n=e.category||e.Category||"Altele";t[n]||(t[n]=[]),t[n].push(e)}),t}function displayMenuCategories(e){const t=document.getElementById("menuCategories");t.style.display="block",t.innerHTML="";const n={Aperitive:"fas fa-leaf",Supe:"fas fa-bowl-hot",Ciorbe:"fas fa-bowl-hot","Feluri principale":"fas fa-utensils",Paste:"fas fa-wheat-awn",Pizza:"fas fa-pizza-slice",Salate:"fas fa-seedling",Deserturi:"fas fa-ice-cream",Bauturi:"fas fa-cocktail",Cafea:"fas fa-coffee",Altele:"fas fa-ellipsis-h"};e.forEach((e,a)=>{const o=document.createElement("div");o.className="menu-category "+(0===a?"active":""),o.innerHTML=`\n      <i class="${getCategoryIcon(e,n)}"></i>\n      <span>${e}</span>\n    `,o.addEventListener("click",()=>{document.querySelectorAll(".menu-category").forEach(e=>{e.classList.remove("active")}),o.classList.add("active");const t=document.getElementById(`category-${e.replace(/\s+/g,"-")}`);t&&t.scrollIntoView({behavior:"smooth",block:"start"})}),t.appendChild(o)})}function getCategoryIcon(e,t){const n=e.toLowerCase();for(const[e,a]of Object.entries(t))if(e.toLowerCase()===n)return a;return n.includes("aperitiv")||n.includes("gustare")?t.Aperitive:n.includes("sup")||n.includes("ciorb")?t.Supe:n.includes("principal")||n.includes("carne")||n.includes("pește")?t["Feluri principale"]:n.includes("past")||n.includes("spaghetti")||n.includes("penne")?t.Paste:n.includes("pizza")?t.Pizza:n.includes("salat")||n.includes("verde")?t.Salate:n.includes("desert")||n.includes("dulce")||n.includes("tort")?t.Deserturi:n.includes("bautur")||n.includes("suc")||n.includes("apa")?t.Bauturi:n.includes("cafea")||n.includes("espresso")||n.includes("cappuccino")?t.Cafea:t.Altele}function displayMenuItems(e){const t=document.getElementById("menuItems");t.innerHTML="",Object.entries(e).forEach(([e,n])=>{const a=document.createElement("div");a.className="menu-section",a.id=`category-${e.replace(/\s+/g,"-")}`;a.innerHTML=`\n      <h3 class="menu-section-title">\n        <i class="${getCategoryIcon(e,{Aperitive:"fas fa-leaf",Supe:"fas fa-bowl-hot",Ciorbe:"fas fa-bowl-hot","Feluri principale":"fas fa-utensils",Paste:"fas fa-wheat-awn",Pizza:"fas fa-pizza-slice",Salate:"fas fa-seedling",Deserturi:"fas fa-ice-cream",Bauturi:"fas fa-cocktail",Cafea:"fas fa-coffee",Altele:"fas fa-ellipsis-h"})}"></i>\n        ${e}\n      </h3>\n      <div class="menu-items-list">\n        ${n.map(e=>createMenuItemHTML(e)).join("")}\n      </div>\n    `,t.appendChild(a)})}function createMenuItemHTML(e){const t=e.name||e.Name||"Nume nedisponibil",n=e.description||e.Description||"",a=e.price||e.Price||null,o=e.ingredients||e.Ingredients||"";return`\n    <div class="menu-item">\n      <div class="menu-item-header">\n        <h4 class="menu-item-name">${t}</h4>\n        <span class="menu-item-price">${a?`${a} Lei`:"Preț la cerere"}</span>\n      </div>\n      ${n?`<p class="menu-item-description">${n}</p>`:""}\n      ${o?`<p class="menu-item-ingredients">Ingrediente: ${o}</p>`:""}\n    </div>\n  `}function displayEmptyMenu(){const e=document.getElementById("menuLoading"),t=document.getElementById("menuError"),n=document.getElementById("menuContent");e.style.display="none",t.style.display="none",n.style.display="flex",document.getElementById("menuCategories").style.display="none";document.getElementById("menuItems").innerHTML='\n    <div class="menu-empty">\n      <i class="fas fa-utensils"></i>\n      <h3>Meniul va fi disponibil în curând</h3>\n      <p>Acest restaurant încă nu și-a încărcat meniul digital. Te rugăm să contactezi restaurantul direct pentru informații despre preparatele disponibile.</p>\n    </div>\n  '}function showMenuError(){const e=document.getElementById("menuLoading"),t=document.getElementById("menuError"),n=document.getElementById("menuContent");e.style.display="none",t.style.display="flex",n.style.display="none";const a=getCurrentRestaurant(),o="N/A"!==a.phone?`<strong><a href="tel:${a.phone.replace(/\s/g,"")}" style="color: var(--primary-color);">📞 ${a.phone}</a></strong>`:"restaurant direct";document.getElementById("menuErrorMessage").innerHTML=`Nu am putut încărca meniul pentru ${a.name}. Te rugăm să contactezi ${o} pentru informații despre preparate.`}function setupFormValidation(){document.querySelectorAll(".form-input").forEach(e=>{e.addEventListener("blur",function(){validateInput(this)}),e.addEventListener("input",function(){this.classList.contains("error")&&validateInput(this)})})}function validateInput(e){const t=e.value;let n=!0,a="";if(e.hasAttribute("required")&&!t)n=!1,a="Acest câmp este obligatoriu";else if("date"===e.type&&t){const e=new Date(t),o=new Date;o.setHours(0,0,0,0),e<o&&(n=!1,a="Data nu poate fi în trecut")}const o=e.parentNode.querySelector(".error-message");if(o&&o.remove(),e.classList.remove("success","error"),n)t&&e.classList.add("success");else{e.classList.add("error");const t=document.createElement("div");t.className="error-message",t.textContent=a,e.parentNode.appendChild(t)}return n}function getCurrentRestaurant(){if(currentLocation){let e="N/A";return currentLocation.Company&&currentLocation.Company.phone?e=currentLocation.Company.phone:currentLocation.phone&&(e=currentLocation.phone),{name:currentLocation.name||currentLocation.Name||"Restaurant",address:currentLocation.address||currentLocation.Address||"",phone:e,cuisine:currentLocation.category||currentLocation.Category||"Restaurant"}}return{name:"Restaurant",address:"",phone:"N/A",cuisine:"Restaurant"}}function initializeAnimations(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=document.querySelector(this.getAttribute("href"));t&&t.scrollIntoView({behavior:"smooth",block:"start"})})});const e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("animate-in")})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".restaurant-section, .info-section, .reservation-section").forEach(t=>e.observe(t))}function initializeNavbar(){const e=document.querySelector(".navbar");if(e){let t=window.scrollY;window.addEventListener("scroll",()=>{const n=window.scrollY;n>100?e.classList.add("scrolled"):e.classList.remove("scrolled"),n>t&&n>200?e.classList.add("hidden"):e.classList.remove("hidden"),t=n})}const t=document.querySelector(".mobile-menu-toggle"),n=document.querySelector(".mobile-menu");t&&n&&t.addEventListener("click",()=>{n.classList.toggle("active"),t.classList.toggle("active")})}function initializeAll(){initializeReservationForm(),setupFormValidation(),initializeAnimations(),initializeNavbar()}document.addEventListener("DOMContentLoaded",function(){try{document.body.classList.add("loading"),document.body.classList.remove("loaded");const e=document.getElementById("immediateLoadingOverlay");e&&(e.id="pageLoadingOverlay",e.style.opacity="1",e.style.visibility="visible");const t=getLocationId();if(!t)return showError("ID-ul locației nu a fost găsit în URL."),void hideLoadingOverlay();loadLocationDetails(t),initializeAll(),"#reservation"===window.location.hash&&setTimeout(()=>{const e=document.querySelector(".reservation-section");e&&e.scrollIntoView({behavior:"smooth"})},1500),setTimeout(()=>{document.querySelectorAll('a[href*=".html"], .btn[href*=".html"], .back-button, .btn-back').forEach(e=>{e.addEventListener("click",function(e){const t=this.getAttribute("href")||this.getAttribute("onclick");if(this.hasAttribute("onclick")){if(this.getAttribute("onclick").includes("goBack()"))return e.preventDefault(),void navigateWithLoading("rezervari.html")}!t||!t.includes(".html")||t.startsWith("http")||t.startsWith("mailto")||t.startsWith("tel")||(e.preventDefault(),navigateWithLoading(t))})})},100)}catch(e){console.error("Restaurant page initialization error:",e),showError("A apărut o problemă la încărcarea paginii."),hideLoadingOverlay()}}),document.addEventListener("visibilitychange",function(){document.hidden||setTimeout(()=>{const e=document.getElementById("pageLoadingOverlay");e&&!e.classList.contains("hidden")&&hideLoadingOverlay()},100)}),window.addEventListener("pageshow",function(e){e.persisted&&hideLoadingOverlay()}),window.addEventListener("beforeunload",function(){showLoadingOverlay()}),window.makeReservation=async function(){const e=validateReservationForm();if(!e.isValid)return void showPopup("Formular incomplet",e.errors.join("<br>"),"fas fa-exclamation-triangle");if(!currentLocation)return void showPopup("Eroare","Datele locației nu sunt disponibile. Te rugăm să reîmprospătezi pagina.","fas fa-exclamation-triangle");const t=document.getElementById("fullName").value.trim(),n=document.getElementById("phoneNumber").value.trim(),a=document.getElementById("reservationDate").value,o=document.getElementById("reservationTime").value,i=document.getElementById("guestCount").value,s={customerName:t,customerEmail:`${t.replace(/\s+/g,"").toLowerCase()}@temp.acoomh.ro`,customerPhone:n,reservationDate:a,reservationTime:o+":00",numberOfPeople:parseInt(i),locationId:parseInt(currentLocation.id),specialRequests:"",status:"Pending"},r=document.querySelector(".btn-rezerva"),c=r.innerHTML;r.disabled=!0,r.innerHTML='<div class="loading"></div> Se procesează...';try{await createReservation(s);r.disabled=!1,r.innerHTML=c;const e=new Date(a).toLocaleDateString("ro-RO",{weekday:"long",year:"numeric",month:"long",day:"numeric"});showPopup("Rezervare confirmată!",`Mulțumim, <strong>${t}</strong>!<br><br>Rezervarea ta la <strong>${currentLocation.name}</strong> pentru <strong>${e}</strong> la ora <strong>${o}</strong> pentru <strong>${i} ${"1"===i?"persoană":"persoane"}</strong> a fost trimisă!<br><br>Vei fi contactat în curând pentru confirmare.`,"fas fa-check-circle",!0),document.getElementById("fullName").value="",document.getElementById("phoneNumber").value="",document.getElementById("reservationDate").value="",document.getElementById("reservationTime").value="",document.getElementById("guestCount").value=""}catch(e){r.disabled=!1,r.innerHTML=c,showPopup("Eroare la rezervare",e.message||"Nu am putut procesa rezervarea. Te rugăm să încerci din nou.","fas fa-exclamation-triangle")}},window.callRestaurant=function(){const e=getCurrentRestaurant();e.phone&&(window.location.href=`tel:${e.phone}`)},window.openMaps=function(){const e=getCurrentRestaurant();if(e.address){const t=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e.address)}`;window.open(t,"_blank")}},window.shareRestaurant=function(){const e=getCurrentRestaurant(),t={title:e.name,text:`Descoperă ${e.name} pe AcoomH!`,url:window.location.href};function fallbackShare(){navigator.clipboard.writeText(window.location.href).then(()=>{showPopup("Link copiat!","Link-ul către restaurant a fost copiat în clipboard.","fas fa-copy",!0)}).catch(()=>{showPopup("Partajare",`Copiază acest link pentru a partaja restaurantul:<br><br><code style="background: var(--bg-dark); padding: 8px; border-radius: 6px; font-size: 0.8rem; word-break: break-all;">${window.location.href}</code>`,"fas fa-share-alt")})}navigator.share?navigator.share(t).catch(e=>{console.log("Error sharing:",e),fallbackShare()}):fallbackShare()},window.viewMenu=async function(){currentLocation?(showMenuModal(),loadMenuData()):showPopup("Eroare","Datele locației nu sunt disponibile. Te rugăm să reîmprospătezi pagina.","fas fa-exclamation-triangle")},window.closeMenuModal=function(){const e=document.getElementById("menuModalOverlay");e.classList.remove("show"),setTimeout(()=>{e.style.display="none",document.body.style.overflow="auto"},300)},window.loadMenuData=async function(){const e=document.getElementById("menuLoading"),t=document.getElementById("menuError"),n=document.getElementById("menuContent");e.style.display="flex",t.style.display="none",n.style.display="none";try{const e=await fetch(`${API_BASE_URL}/locations/${currentLocation.id}/menu-items`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(e.ok){const t=await e.json();console.log("✅ Successfully loaded menu data:",t),t&&(Array.isArray(t)?t.length>0:Object.keys(t).length>0)?displayMenuData(t):displayEmptyMenu()}else{if(404!==e.status)throw new Error(`Server error: ${e.status}`);tryPdfMenuFallback()}}catch(e){console.error("Error loading menu data:",e),tryPdfMenuFallback()}},window.downloadPdfMenu=function(){if(window.currentMenuPdf){const e=getCurrentRestaurant(),t=URL.createObjectURL(window.currentMenuPdf),n=document.createElement("a");n.href=t,n.download=`Meniu-${e.name.replace(/\s+/g,"-")}.pdf`,n.click(),setTimeout(()=>{URL.revokeObjectURL(t)},1e3)}},window.viewPdfMenu=function(){if(window.currentMenuPdf){const e=URL.createObjectURL(window.currentMenuPdf);window.open(e,"_blank"),setTimeout(()=>{URL.revokeObjectURL(e)},6e4)}},document.addEventListener("click",function(e){const t=document.getElementById("menuModalOverlay");e.target===t&&closeMenuModal()}),document.addEventListener("keydown",function(e){if("Escape"===e.key){const e=document.getElementById("menuModalOverlay");e&&e.classList.contains("show")&&closeMenuModal()}}),window.goBack=function(){document.referrer&&document.referrer.includes(window.location.origin)?history.back():window.location.href="index.html"},initializeAll(),window.addEventListener("load",function(){document.body.classList.add("loaded")}),console.log("Restaurant page initialized successfully");const RestaurantUtils={formatPhoneNumber:function(e){return e.replace(/(\d{4})(\d{3})(\d{3})/,"$1 $2 $3")},isRestaurantOpen:function(e){const t=new Date,n=t.toLocaleDateString("ro-RO",{weekday:"long"}),a=n.charAt(0).toUpperCase()+n.slice(1),o=100*t.getHours()+t.getMinutes(),i=e[a];if(!i||i.toLowerCase().includes("închis"))return!1;const[s,r]=i.split(" - ").map(e=>{const[t,n]=e.split(":").map(Number);return 100*t+n});return o>=s&&o<=r},generateStarsHTML:function(e){const t=Math.floor(e),n=e%1!=0;let a="";for(let e=0;e<t;e++)a+='<i class="fas fa-star"></i>';n&&(a+='<i class="fas fa-star-half-alt"></i>');const o=5-Math.ceil(e);for(let e=0;e<o;e++)a+='<i class="far fa-star"></i>';return a}};