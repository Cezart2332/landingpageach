document.body.classList.add("loading");const immediateOverlay=document.createElement("div");immediateOverlay.className="page-loading-overlay",immediateOverlay.id="pageLoadingOverlay",immediateOverlay.innerHTML='\n  <div class="loading-spinner-container">\n    <div class="modern-loading-spinner"></div>\n    <div class="loading-text">\n      Se încarcă<span class="loading-dots"></span>\n    </div>\n  </div>\n',document.body.appendChild(immediateOverlay);const API_BASE_URL="https://api.acoomh.ro";let allMerchantRequests=[],filteredMerchantRequests=[],currentSearchTerm="",currentStatusFilter="all",currentBusinessTypeFilter="all",currentSortBy="newest",selectedMerchantRequest=null;async function loadMerchantRequests(){showLoadingState();try{const e=await fetch(`${API_BASE_URL}/merchant-requests`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();allMerchantRequests=t,filteredMerchantRequests=t,updateStatistics(),displayMerchantRequests(filteredMerchantRequests),hideLoadingState(),console.log("✅ Successfully loaded merchant requests:",t.length)}catch(e){console.error("Error loading merchant requests:",e),loadMockData()}}function loadMockData(){const e=[{id:1,businessName:"Taverna Rustica",businessType:"restaurant",status:"pending",ownerName:"Gheorghe Popescu",ownerEmail:"gheorghe.popescu@email.com",ownerPhone:"+40721234567",businessAddress:"Str. Libertății nr. 15, Cluj-Napoca",businessDescription:"Restaurant tradițional cu specific românesc, folosind ingrediente locale și rețete autentice transmise din generație în generație.",yearsInBusiness:8,numberOfEmployees:12,averageDailyCustomers:80,businessHours:{monday:"10:00-22:00",tuesday:"10:00-22:00",wednesday:"10:00-22:00",thursday:"10:00-22:00",friday:"10:00-23:00",saturday:"10:00-23:00",sunday:"12:00-21:00"},documents:{businessLicense:"license_taverna_rustica.pdf",taxRegistration:"tax_reg_taverna_rustica.pdf",menuCard:"menu_taverna_rustica.pdf"},createdAt:"2025-08-03T09:15:00Z",updatedAt:"2025-08-03T09:15:00Z"},{id:2,businessName:"Coffee Corner",businessType:"cafe",status:"approved",ownerName:"Maria Ionescu",ownerEmail:"maria@coffeecorner.ro",ownerPhone:"+40733456789",businessAddress:"Bd. Eroilor nr. 42, București",businessDescription:"Cafenea modernă cu cafea specialty, atmosphere relaxantă și WiFi gratuit pentru freelanceri și studenți.",yearsInBusiness:3,numberOfEmployees:6,averageDailyCustomers:120,businessHours:{monday:"07:00-20:00",tuesday:"07:00-20:00",wednesday:"07:00-20:00",thursday:"07:00-20:00",friday:"07:00-22:00",saturday:"08:00-22:00",sunday:"09:00-19:00"},documents:{businessLicense:"license_coffee_corner.pdf",taxRegistration:"tax_reg_coffee_corner.pdf",menuCard:"menu_coffee_corner.pdf"},createdAt:"2025-08-02T14:30:00Z",updatedAt:"2025-08-03T10:45:00Z",approvedAt:"2025-08-03T10:45:00Z",approvedBy:"admin@acoomh.ro"},{id:3,businessName:"The Irish Pub",businessType:"pub",status:"rejected",ownerName:"John O'Connor",ownerEmail:"john@irishpub.ro",ownerPhone:"+40744567890",businessAddress:"Str. Republicii nr. 28, Timișoara",businessDescription:"Pub irlandez autentic cu bere la halba, muzică live și atmosphere tradiționaler irlandeză.",yearsInBusiness:5,numberOfEmployees:8,averageDailyCustomers:60,businessHours:{monday:"Închis",tuesday:"16:00-02:00",wednesday:"16:00-02:00",thursday:"16:00-02:00",friday:"16:00-03:00",saturday:"14:00-03:00",sunday:"14:00-24:00"},documents:{businessLicense:"license_irish_pub.pdf",taxRegistration:"tax_reg_irish_pub.pdf"},createdAt:"2025-08-01T11:20:00Z",updatedAt:"2025-08-02T16:15:00Z",rejectedAt:"2025-08-02T16:15:00Z",rejectedBy:"admin@acoomh.ro",rejectionReason:"Documentația incompletă - lipsește licența pentru vânzarea de băuturi alcoolice."},{id:4,businessName:"Sunset Club",businessType:"club",status:"pending",ownerName:"Alexandra Mihai",ownerEmail:"alex@sunsetclub.ro",ownerPhone:"+40755678901",businessAddress:"Calea Victoriei nr. 87, București",businessDescription:"Club de noapte modern cu DJs renumiți, sistemul de sunet de ultimă generație și atmosphere exclusivistă.",yearsInBusiness:2,numberOfEmployees:25,averageDailyCustomers:200,businessHours:{monday:"Închis",tuesday:"Închis",wednesday:"Închis",thursday:"22:00-06:00",friday:"22:00-06:00",saturday:"22:00-06:00",sunday:"Închis"},documents:{businessLicense:"license_sunset_club.pdf",taxRegistration:"tax_reg_sunset_club.pdf",soundLicense:"sound_license_sunset_club.pdf"},createdAt:"2025-08-03T16:45:00Z",updatedAt:"2025-08-03T16:45:00Z"},{id:5,businessName:"Bella Vista",businessType:"restaurant",status:"approved",ownerName:"Roberto Martinelli",ownerEmail:"roberto@bellavista.ro",ownerPhone:"+40766789012",businessAddress:"Str. Kogălniceanu nr. 23, Constanța",businessDescription:"Restaurant italian cu vedere la mare, pizza autentică în cuptor cu lemne și paste făcute în casă.",yearsInBusiness:6,numberOfEmployees:15,averageDailyCustomers:90,businessHours:{monday:"11:00-23:00",tuesday:"11:00-23:00",wednesday:"11:00-23:00",thursday:"11:00-23:00",friday:"11:00-24:00",saturday:"11:00-24:00",sunday:"11:00-22:00"},documents:{businessLicense:"license_bella_vista.pdf",taxRegistration:"tax_reg_bella_vista.pdf",menuCard:"menu_bella_vista.pdf"},createdAt:"2025-08-01T08:30:00Z",updatedAt:"2025-08-02T09:20:00Z",approvedAt:"2025-08-02T09:20:00Z",approvedBy:"admin@acoomh.ro"}];allMerchantRequests=e,filteredMerchantRequests=e,updateStatistics(),displayMerchantRequests(filteredMerchantRequests),hideLoadingState(),console.log("✅ Loaded mock merchant requests for development")}function showLoadingState(){document.getElementById("loadingState").style.display="flex",document.getElementById("errorState").style.display="none",document.getElementById("requestsContainer").style.display="none",document.getElementById("emptyState").style.display="none"}function showErrorState(e){document.getElementById("loadingState").style.display="none",document.getElementById("errorState").style.display="flex",document.getElementById("requestsContainer").style.display="none",document.getElementById("emptyState").style.display="none",document.getElementById("errorMessage").textContent=e||"Nu am putut încărca cererile comercianților."}function hideLoadingState(){document.getElementById("loadingState").style.display="none",document.getElementById("errorState").style.display="none"}function displayMerchantRequests(e){const t=document.getElementById("requestsGrid"),n=document.getElementById("requestsContainer"),s=document.getElementById("emptyState");if(!e||0===e.length)return n.style.display="none",void(s.style.display="flex");n.style.display="block",s.style.display="none",t.innerHTML="",e.forEach(e=>{const n=createMerchantRequestCard(e);t.appendChild(n)})}function createMerchantRequestCard(e){const t=document.createElement("div");t.className="merchant-request-card",t.onclick=()=>openMerchantModal(e);const n=new Date(e.createdAt).toLocaleDateString("ro-RO",{day:"numeric",month:"short",year:"numeric"}),s=e.status,a=getBusinessTypeIcon(e.businessType);return t.innerHTML=`\n    <div class="request-header">\n      <div class="business-info">\n        <div class="business-name">${e.businessName}</div>\n        <div class="business-type">\n          ${a}\n          ${getBusinessTypeText(e.businessType)}\n        </div>\n      </div>\n      <div class="request-status ${s}">${getStatusText(e.status)}</div>\n    </div>\n    \n    <div class="request-details">\n      <div class="contact-info">\n        <div class="contact-item">\n          <i class="fas fa-user"></i>\n          <span>${e.ownerName}</span>\n        </div>\n        <div class="contact-item">\n          <i class="fas fa-envelope"></i>\n          <span>${e.ownerEmail}</span>\n        </div>\n        <div class="contact-item">\n          <i class="fas fa-phone"></i>\n          <span>${e.ownerPhone}</span>\n        </div>\n        <div class="contact-item">\n          <i class="fas fa-map-marker-alt"></i>\n          <span>${e.businessAddress}</span>\n        </div>\n      </div>\n    </div>\n    \n    <div class="request-meta">\n      <div class="request-id">#${e.id}</div>\n      <div class="request-date">${n}</div>\n    </div>\n  `,t}function getStatusText(e){return{pending:"În Așteptare",approved:"Aprobat",rejected:"Respins"}[e]||e}function getBusinessTypeText(e){return{restaurant:"Restaurant",cafe:"Cafenea",pub:"Pub",club:"Club",bar:"Bar"}[e]||e}function getBusinessTypeIcon(e){return{restaurant:'<i class="fas fa-utensils"></i>',cafe:'<i class="fas fa-coffee"></i>',pub:'<i class="fas fa-beer"></i>',club:'<i class="fas fa-music"></i>',bar:'<i class="fas fa-cocktail"></i>'}[e]||'<i class="fas fa-store"></i>'}function updateStatistics(){const e=allMerchantRequests.filter(e=>"pending"===e.status).length,t=allMerchantRequests.filter(e=>"approved"===e.status).length,n=allMerchantRequests.filter(e=>"rejected"===e.status).length,s=allMerchantRequests.length;document.getElementById("pendingRequestsCount").textContent=e,document.getElementById("approvedRequestsCount").textContent=t,document.getElementById("rejectedRequestsCount").textContent=n,document.getElementById("totalRequestsCount").textContent=s}function initializeFilters(){const e=document.getElementById("statusFilter"),t=document.getElementById("businessTypeFilter"),n=document.getElementById("sortBy");e.addEventListener("change",function(){currentStatusFilter=this.value,applyFilters()}),t.addEventListener("change",function(){currentBusinessTypeFilter=this.value,applyFilters()}),n.addEventListener("change",function(){currentSortBy=this.value,applyFilters()})}function initializeSearch(){const e=document.getElementById("searchInput");e&&e.addEventListener("input",function(){currentSearchTerm=this.value.trim().toLowerCase(),applyFilters()})}function applyFilters(){let e=[...allMerchantRequests];"all"!==currentStatusFilter&&(e=e.filter(e=>e.status===currentStatusFilter)),"all"!==currentBusinessTypeFilter&&(e=e.filter(e=>e.businessType===currentBusinessTypeFilter)),currentSearchTerm&&(e=e.filter(e=>e.businessName.toLowerCase().includes(currentSearchTerm)||e.ownerName.toLowerCase().includes(currentSearchTerm)||e.ownerEmail.toLowerCase().includes(currentSearchTerm)||e.ownerPhone.toLowerCase().includes(currentSearchTerm)||e.businessAddress.toLowerCase().includes(currentSearchTerm))),e.sort((e,t)=>{switch(currentSortBy){case"newest":return new Date(t.createdAt)-new Date(e.createdAt);case"oldest":return new Date(e.createdAt)-new Date(t.createdAt);case"name":return e.businessName.localeCompare(t.businessName);case"status":const n={pending:3,approved:2,rejected:1};return n[t.status]-n[e.status];default:return 0}}),filteredMerchantRequests=e,displayMerchantRequests(filteredMerchantRequests)}function openMerchantModal(e){selectedMerchantRequest=e;const t=document.getElementById("merchantModal"),n=document.getElementById("modalTitle"),s=document.getElementById("modalBody"),a=document.getElementById("actionButtons");n.textContent=`Cerere Comerciant #${e.id}`;const i=new Date(e.createdAt).toLocaleString("ro-RO"),r=new Date(e.updatedAt).toLocaleString("ro-RO"),o=Object.entries(e.businessHours||{}).map(([e,t])=>`\n      <div class="hour-item">\n        <span class="hour-day">${{monday:"Luni",tuesday:"Marți",wednesday:"Miercuri",thursday:"Joi",friday:"Vineri",saturday:"Sâmbătă",sunday:"Duminică"}[e]}:</span>\n        <span class="hour-time">${t}</span>\n      </div>\n    `).join(""),d=e.documents?Object.entries(e.documents).map(([e,t])=>`\n      <a href="#" class="document-link" onclick="downloadDocument('${t}')">\n        <i class="fas fa-file-pdf"></i>\n        ${{businessLicense:"Licență Comercială",taxRegistration:"Înregistrare Fiscală",menuCard:"Meniu",soundLicense:"Licență Sonorizare"}[e]||e}\n      </a>\n    `).join(""):"Nu sunt documente încărcate";s.innerHTML=`\n    <div class="info-grid">\n      <div class="info-section">\n        <h4><i class="fas fa-store"></i> Informații Business</h4>\n        <p><strong>Nume:</strong> ${e.businessName}</p>\n        <p><strong>Tip:</strong> ${getBusinessTypeText(e.businessType)}</p>\n        <p><strong>Adresă:</strong> ${e.businessAddress}</p>\n        <p><strong>Ani în business:</strong> ${e.yearsInBusiness} ani</p>\n        <p><strong>Numărul de angajați:</strong> ${e.numberOfEmployees}</p>\n        <p><strong>Clienți zilnic (media):</strong> ${e.averageDailyCustomers}</p>\n      </div>\n      \n      <div class="info-section">\n        <h4><i class="fas fa-user"></i> Informații Proprietar</h4>\n        <p><strong>Nume:</strong> ${e.ownerName}</p>\n        <p><strong>Email:</strong> ${e.ownerEmail}</p>\n        <p><strong>Telefon:</strong> ${e.ownerPhone}</p>\n        <p><strong>Status:</strong> <span class="request-status ${e.status}">${getStatusText(e.status)}</span></p>\n      </div>\n    </div>\n    \n    <div class="info-section">\n      <h4><i class="fas fa-align-left"></i> Descriere Business</h4>\n      <p style="line-height: 1.6; color: var(--text-secondary);">${e.businessDescription}</p>\n    </div>\n    \n    <div class="info-section">\n      <h4><i class="fas fa-clock"></i> Program de Lucru</h4>\n      <div class="hours-grid">\n        ${o}\n      </div>\n    </div>\n    \n    <div class="info-section">\n      <h4><i class="fas fa-file"></i> Documente</h4>\n      <div style="display: flex; flex-wrap: wrap; gap: 10px;">\n        ${d}\n      </div>\n    </div>\n    \n    <div class="info-grid">\n      <div class="info-section">\n        <h4><i class="fas fa-calendar"></i> Creat la</h4>\n        <p>${i}</p>\n      </div>\n      \n      <div class="info-section">\n        <h4><i class="fas fa-edit"></i> Ultima actualizare</h4>\n        <p>${r}</p>\n      </div>\n    </div>\n    \n    ${"approved"===e.status?`\n      <div class="info-section" style="background: rgba(16, 185, 129, 0.1); border-color: var(--success-color);">\n        <h4 style="color: var(--success-color);"><i class="fas fa-check-circle"></i> Aprobat</h4>\n        <p><strong>Aprobat la:</strong> ${new Date(e.approvedAt).toLocaleString("ro-RO")}</p>\n        <p><strong>Aprobat de:</strong> ${e.approvedBy}</p>\n      </div>\n    `:""}\n    \n    ${"rejected"===e.status?`\n      <div class="info-section" style="background: rgba(239, 68, 68, 0.1); border-color: var(--error-color);">\n        <h4 style="color: var(--error-color);"><i class="fas fa-times-circle"></i> Respins</h4>\n        <p><strong>Respins la:</strong> ${new Date(e.rejectedAt).toLocaleString("ro-RO")}</p>\n        <p><strong>Respins de:</strong> ${e.rejectedBy}</p>\n        <p><strong>Motiv:</strong> ${e.rejectionReason}</p>\n      </div>\n    `:""}\n  `,"pending"===e.status?a.style.display="flex":a.style.display="none",t.style.display="flex",setTimeout(()=>t.classList.add("show"),10)}function closeMerchantModal(){const e=document.getElementById("merchantModal");e.classList.remove("show"),setTimeout(()=>{e.style.display="none",selectedMerchantRequest=null},300)}function updateRequestStatus(e){selectedMerchantRequest&&("rejected"===e?openRejectionModal():"approved"===e&&performStatusUpdate("approved"))}function openRejectionModal(){const e=document.getElementById("rejectionModal");document.getElementById("rejectionReason").value="",e.style.display="flex",setTimeout(()=>e.classList.add("show"),10)}function closeRejectionModal(){const e=document.getElementById("rejectionModal");e.classList.remove("show"),setTimeout(()=>{e.style.display="none"},300)}function confirmRejection(){const e=document.getElementById("rejectionReason").value.trim();e?(performStatusUpdate("rejected",e),closeRejectionModal()):showNotification("Te rugăm să specifici un motiv pentru respingere","error")}async function performStatusUpdate(e,t=null){if(!selectedMerchantRequest)return;const n=document.getElementById("approveBtn"),s=document.getElementById("rejectBtn");n.disabled=!0,s.disabled=!0;const a=n.textContent,i=s.textContent;"approved"===e?n.textContent="Se aprobă...":s.textContent="Se respinge...";try{const n={status:e,...t&&{rejectionReason:t}};if(!(await fetch(`${API_BASE_URL}/merchant-requests/${selectedMerchantRequest.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).ok)throw new Error("Failed to update status");const s=allMerchantRequests.findIndex(e=>e.id===selectedMerchantRequest.id);-1!==s&&(allMerchantRequests[s].status=e,allMerchantRequests[s].updatedAt=(new Date).toISOString(),"approved"===e?(allMerchantRequests[s].approvedAt=(new Date).toISOString(),allMerchantRequests[s].approvedBy="admin@acoomh.ro"):"rejected"===e&&(allMerchantRequests[s].rejectedAt=(new Date).toISOString(),allMerchantRequests[s].rejectedBy="admin@acoomh.ro",allMerchantRequests[s].rejectionReason=t)),updateStatistics(),applyFilters(),closeMerchantModal(),showNotification("approved"===e?"Cererea a fost aprobată cu succes!":"Cererea a fost respinsă cu succes!","success")}catch(n){console.error("Error updating request status:",n);const s=allMerchantRequests.findIndex(e=>e.id===selectedMerchantRequest.id);-1!==s&&(allMerchantRequests[s].status=e,allMerchantRequests[s].updatedAt=(new Date).toISOString(),"approved"===e?(allMerchantRequests[s].approvedAt=(new Date).toISOString(),allMerchantRequests[s].approvedBy="admin@acoomh.ro"):"rejected"===e&&(allMerchantRequests[s].rejectedAt=(new Date).toISOString(),allMerchantRequests[s].rejectedBy="admin@acoomh.ro",allMerchantRequests[s].rejectionReason=t)),updateStatistics(),applyFilters(),closeMerchantModal(),showNotification("Status actualizat (mod dezvoltare) - "+("approved"===e?"Aprobat":"Respins"),"info")}finally{n.disabled=!1,s.disabled=!1,n.textContent=a,s.textContent=i}}function downloadDocument(e){showNotification(`Descărcare simulată: ${e}`,"info"),console.log("Download document:",e)}function showNotification(e,t="info"){const n=document.createElement("div");n.style.cssText=`\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    background: ${"success"===t?"var(--success-color)":"error"===t?"var(--error-color)":"var(--info-color)"};\n    color: white;\n    padding: 15px 20px;\n    border-radius: 10px;\n    font-weight: 600;\n    z-index: 10000;\n    transform: translateX(400px);\n    transition: transform 0.3s ease;\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n    max-width: 300px;\n  `,n.textContent=e,document.body.appendChild(n),setTimeout(()=>{n.style.transform="translateX(0)"},100),setTimeout(()=>{n.style.transform="translateX(400px)",setTimeout(()=>{document.body.contains(n)&&document.body.removeChild(n)},300)},4e3)}function setupNavigation(){document.querySelectorAll('a[href*=".html"]').forEach(e=>{e.addEventListener("click",function(e){const t=this.getAttribute("href");!t||!t.includes(".html")||t.startsWith("http")||t.startsWith("mailto")||t.startsWith("tel")||(e.preventDefault(),navigateWithLoading(t))})})}function createLoadingOverlay(){const e=document.createElement("div");return e.className="page-loading-overlay",e.id="pageLoadingOverlay",e.innerHTML='\n    <div class="loading-spinner-container">\n      <div class="modern-loading-spinner"></div>\n      <div class="loading-text">\n        Se încarcă<span class="loading-dots"></span>\n      </div>\n    </div>\n  ',document.body.appendChild(e),e}function showLoadingOverlay(){document.body.classList.add("loading"),document.body.classList.remove("loaded");let e=document.getElementById("pageLoadingOverlay");e||(e=createLoadingOverlay()),e.classList.remove("hidden")}function hideLoadingOverlay(){const e=document.getElementById("pageLoadingOverlay");e&&(e.classList.add("hidden"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},500)),document.body.classList.remove("loading"),document.body.classList.add("loaded")}function navigateWithLoading(e){clearTimeout(window.loadingTimeout),showLoadingOverlay(),window.location.href=e}document.addEventListener("DOMContentLoaded",function(){try{initializeFilters(),initializeSearch(),loadMerchantRequests(),setTimeout(()=>{hideLoadingOverlay()},800),setupNavigation()}catch(e){console.error("Merchant requests page initialization error:",e),hideLoadingOverlay()}}),document.addEventListener("visibilitychange",function(){document.hidden||setTimeout(()=>{const e=document.getElementById("pageLoadingOverlay");e&&!e.classList.contains("hidden")&&hideLoadingOverlay()},100)}),window.addEventListener("pageshow",function(e){e.persisted&&hideLoadingOverlay()}),window.addEventListener("beforeunload",function(){showLoadingOverlay()}),window.loadMerchantRequests=loadMerchantRequests,window.closeMerchantModal=closeMerchantModal,window.closeRejectionModal=closeRejectionModal,window.updateRequestStatus=updateRequestStatus,window.confirmRejection=confirmRejection,window.downloadDocument=downloadDocument;