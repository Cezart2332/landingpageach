const API_BASE_URL="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||""===window.location.hostname?"https://cors-anywhere.herokuapp.com/https://api.acoomh.ro":"https://api.acoomh.ro";let allLocations=[],filteredLocations=[],currentFilter="all",currentSearchTerm="";async function loadLocations(){showLoadingState();try{const t={"Content-Type":"application/json",Accept:"application/json"};"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname&&""!==window.location.hostname||(t["X-Requested-With"]="XMLHttpRequest");const e=await fetch(`${API_BASE_URL}/locations`,{method:"GET",headers:t});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const n=await e.json();allLocations=n,filteredLocations=n,displayLocations(filteredLocations),hideLoadingState(),console.log("✅ Successfully loaded locations from API:",n.length)}catch(t){console.error("Error loading locations from API:",t),showErrorState(`Nu am putut încărca locațiile. ${t.message}`)}}function showLoadingState(){document.getElementById("loadingState").style.display="block",document.getElementById("errorState").style.display="none",document.getElementById("locationsContainer").style.display="none",document.getElementById("emptyResults").style.display="none"}function showErrorState(t){document.getElementById("loadingState").style.display="none",document.getElementById("errorState").style.display="block",document.getElementById("locationsContainer").style.display="none",document.getElementById("emptyResults").style.display="none",document.getElementById("errorMessage").textContent=t||"Nu am putut încărca locațiile disponibile."}function hideLoadingState(){document.getElementById("loadingState").style.display="none",document.getElementById("errorState").style.display="none"}function displayLocations(t){const e=document.getElementById("locationsGrid"),n=document.getElementById("locationsContainer"),o=document.getElementById("emptyResults");if(!t||0===t.length)return n.style.display="none",void(o.style.display="block");n.style.display="block",o.style.display="none",e.innerHTML="",t.forEach(t=>{const n=createLocationCard(t);e.appendChild(n)})}function createLocationCard(t){const e=document.createElement("div");e.className="location-card",e.onclick=()=>openLocationDetails(t.id);const n=t.tags&&"string"==typeof t.tags?t.tags.split(",").map(t=>t.trim()).filter(t=>t):[],o=t.photo&&t.photo.length>0?`data:image/jpeg;base64,${arrayBufferToBase64(t.photo)}`:"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80";return e.innerHTML=`\n    <div class="location-image">\n      <img src="${o}" alt="${t.name}" onerror="this.src='https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80'">\n      <div class="location-category">${getCategoryIcon(t.category)} ${t.category}</div>\n    </div>\n    <div class="location-content">\n      <h3 class="location-name">${t.name}</h3>\n      <p class="location-address">\n        <i class="fas fa-map-marker-alt"></i>\n        ${t.address}\n      </p>\n      ${n.length>0?`\n        <div class="location-tags">\n          ${n.slice(0,3).map(t=>`<span class="location-tag">${t}</span>`).join("")}\n          ${n.length>3?`<span class="location-tag-more">+${n.length-3}</span>`:""}\n        </div>\n      `:""}\n      <div class="location-actions">\n        <button class="btn-view-details">\n          <i class="fas fa-eye"></i>\n          Vezi detalii\n        </button>\n        <button class="btn-reserve" onclick="event.stopPropagation(); quickReserve(${t.id})">\n          <i class="fas fa-calendar-check"></i>\n          Rezervă\n        </button>\n      </div>\n    </div>\n  `,e}function getCategoryIcon(t){return`<i class="${{restaurant:"fas fa-utensils",cafe:"fas fa-coffee",pub:"fas fa-beer",club:"fas fa-music",bar:"fas fa-cocktail"}[t.toLowerCase()]||"fas fa-store"}"></i>`}function arrayBufferToBase64(t){let e="";const n=new Uint8Array(t),o=n.byteLength;for(let t=0;t<o;t++)e+=String.fromCharCode(n[t]);return window.btoa(e)}function openLocationDetails(t){window.location.href=`restaurant.html?id=${t}`}function quickReserve(t){window.location.href=`restaurant.html?id=${t}#reservation`}function initializeFiltering(){const t=document.querySelectorAll(".filter-btn");t.forEach(e=>{e.addEventListener("click",function(){t.forEach(t=>t.classList.remove("active")),this.classList.add("active"),currentFilter=this.dataset.type,applyFilters()})})}function applyFilters(){let t=[...allLocations];if("all"!==currentFilter){const e={restaurants:["restaurant","restaurante"],cafes:["cafe","cafenea","coffee"],pubs:["pub","brewery"],clubs:["club","nightclub","disco"]}[currentFilter]||[currentFilter];t=t.filter(t=>e.some(e=>t.category.toLowerCase().includes(e.toLowerCase())))}currentSearchTerm&&(t=t.filter(t=>t.name.toLowerCase().includes(currentSearchTerm.toLowerCase())||t.address.toLowerCase().includes(currentSearchTerm.toLowerCase())||t.category.toLowerCase().includes(currentSearchTerm.toLowerCase())||t.tags&&t.tags.toLowerCase().includes(currentSearchTerm.toLowerCase()))),filteredLocations=t,displayLocations(filteredLocations)}function initializeSearch(){const t=document.getElementById("searchInput");t&&(t.addEventListener("input",function(){currentSearchTerm=this.value.trim(),applyFilters()}),t.addEventListener("keypress",function(t){"Enter"===t.key&&(t.preventDefault(),applyFilters())}))}function initializeInteractions(){const t=document.querySelectorAll(".filter-btn"),e=document.getElementById("searchInput"),n=document.querySelector(".search-box");t.forEach(t=>{t.addEventListener("mouseenter",function(){this.classList.contains("active")||(this.style.transform="translateY(-2px)")}),t.addEventListener("mouseleave",function(){this.classList.contains("active")||(this.style.transform="translateY(0)")})}),e&&n&&(e.addEventListener("focus",function(){n.style.transform="translateY(-2px)"}),e.addEventListener("blur",function(){n.style.transform="translateY(0)"}));const o=document.querySelector(".back-button");o&&(o.addEventListener("mouseenter",function(){this.style.transform="translateY(-2px)"}),o.addEventListener("mouseleave",function(){this.style.transform="translateY(0)"}))}function showNotification(t,e="info"){const n=document.createElement("div");n.className=`notification ${e}`,n.innerHTML=`\n    <i class="fas fa-${"success"===e?"check-circle":"error"===e?"exclamation-circle":"info-circle"}"></i>\n    <span>${t}</span>\n  `,document.body.appendChild(n),setTimeout(()=>{n.classList.add("show")},100),setTimeout(()=>{n.classList.remove("show"),setTimeout(()=>{document.body.contains(n)&&document.body.removeChild(n)},300)},3e3)}document.addEventListener("DOMContentLoaded",function(){initializeFiltering(),initializeSearch(),initializeInteractions(),loadLocations()}),window.rezervariPage={loadLocations:loadLocations,showNotification:showNotification};