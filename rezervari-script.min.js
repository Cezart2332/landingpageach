const API_BASE_URL="https://api.acoomh.ro";let allLocations=[],filteredLocations=[],currentFilter="all",currentSearchTerm="";async function loadLocations(){showLoadingState();try{const e=await fetch(`${API_BASE_URL}/locations`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();allLocations=t,filteredLocations=t,displayLocations(filteredLocations),hideLoadingState(),setTimeout(()=>{hideLoadingOverlay()},800),console.log("✅ Successfully loaded locations from API:",t.length)}catch(e){console.error("Error loading locations from API:",e),showErrorState(`Nu am putut încărca locațiile. ${e.message}`),hideLoadingOverlay()}}function showLoadingState(){document.getElementById("loadingState").style.display="block",document.getElementById("errorState").style.display="none",document.getElementById("locationsContainer").style.display="none",document.getElementById("emptyResults").style.display="none"}function showErrorState(e){document.getElementById("loadingState").style.display="none",document.getElementById("errorState").style.display="block",document.getElementById("locationsContainer").style.display="none",document.getElementById("emptyResults").style.display="none",document.getElementById("errorMessage").textContent=e||"Nu am putut încărca locațiile disponibile."}function hideLoadingState(){document.getElementById("loadingState").style.display="none",document.getElementById("errorState").style.display="none"}function displayLocations(e){const t=document.getElementById("locationsGrid"),n=document.getElementById("locationsContainer"),a=document.getElementById("emptyResults");if(!e||0===e.length)return n.style.display="none",void(a.style.display="block");n.style.display="block",a.style.display="none",t.innerHTML="",e.forEach(e=>{const n=createLocationCard(e);t.appendChild(n)})}function createLocationCard(e){const t=document.createElement("div");t.className="location-card";const n=e.tags&&"string"==typeof e.tags?e.tags.split(",").map(e=>e.trim()).filter(e=>e):[];let a="https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80";if(e.photo)try{if("string"==typeof e.photo)a=e.photo.startsWith("data:image/")||e.photo.startsWith("http")?e.photo:`data:image/jpeg;base64,${e.photo}`;else if(Array.isArray(e.photo)&&e.photo.length>0){a=`data:image/jpeg;base64,${arrayBufferToBase64(e.photo)}`}else if(e.photo.constructor===ArrayBuffer||e.photo.buffer){a=`data:image/jpeg;base64,${arrayBufferToBase64(new Uint8Array(e.photo))}`}}catch(t){console.error("Error processing image for location:",e.id,t)}t.innerHTML=`\n    <div class="location-image">\n      <img src="${a}" alt="${e.name}" onerror="this.src='https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80'">\n      <div class="location-category">${getCategoryIcon(e.category)} ${e.category}</div>\n    </div>\n    <div class="location-content">\n      <h3 class="location-name">${e.name}</h3>\n      <p class="location-address">\n        <i class="fas fa-map-marker-alt"></i>\n        ${e.address}\n      </p>\n      ${n.length>0?`\n        <div class="location-tags">\n          ${n.slice(0,3).map(e=>`<span class="location-tag">${e}</span>`).join("")}\n          ${n.length>3?`<span class="location-tag-more">+${n.length-3}</span>`:""}\n        </div>\n      `:""}\n      <div class="location-actions">\n        <button class="btn-view-details" data-location-id="${e.id}">\n          <i class="fas fa-eye"></i>\n          Vezi detalii\n        </button>\n        <button class="btn-reserve" data-location-id="${e.id}">\n          <i class="fas fa-calendar-check"></i>\n          Rezervă\n        </button>\n      </div>\n    </div>\n  `;const o=t.querySelector(".btn-view-details"),i=t.querySelector(".btn-reserve");return o.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),document.body.style.pointerEvents="none",showLoadingOverlayImmediately(),document.body.offsetHeight,window.location.href=`restaurant.html?id=${e.id}`}),i.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),document.body.style.pointerEvents="none",showLoadingOverlayImmediately(),document.body.offsetHeight,window.location.href=`restaurant.html?id=${e.id}#reservation`}),t.addEventListener("click",function(t){t.target.closest(".btn-view-details")||t.target.closest(".btn-reserve")||(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),document.body.style.pointerEvents="none",showLoadingOverlayImmediately(),document.body.offsetHeight,window.location.href=`restaurant.html?id=${e.id}`)}),t}function getCategoryIcon(e){return`<i class="${{restaurant:"fas fa-utensils",cafe:"fas fa-coffee",pub:"fas fa-beer",club:"fas fa-music",bar:"fas fa-cocktail"}[e.toLowerCase()]||"fas fa-store"}"></i>`}function arrayBufferToBase64(e){let t="";const n=new Uint8Array(e),a=n.byteLength;for(let e=0;e<a;e++)t+=String.fromCharCode(n[e]);return window.btoa(t)}function openLocationDetails(e){window.location.href=`restaurant.html?id=${e}`}function quickReserve(e){window.location.href=`restaurant.html?id=${e}#reservation`}function initializeFiltering(){const e=document.querySelectorAll(".filter-btn");e.forEach(t=>{t.addEventListener("click",function(){e.forEach(e=>e.classList.remove("active")),this.classList.add("active"),currentFilter=this.dataset.type,applyFilters()})})}function applyFilters(){let e=[...allLocations];if("all"!==currentFilter){const t={restaurants:["restaurant","restaurante"],cafes:["cafe","cafenea","coffee"],pubs:["pub","brewery"],clubs:["club","nightclub","disco"]}[currentFilter]||[currentFilter];e=e.filter(e=>t.some(t=>e.category.toLowerCase().includes(t.toLowerCase())))}currentSearchTerm&&(e=e.filter(e=>e.name.toLowerCase().includes(currentSearchTerm.toLowerCase())||e.address.toLowerCase().includes(currentSearchTerm.toLowerCase())||e.category.toLowerCase().includes(currentSearchTerm.toLowerCase())||e.tags&&e.tags.toLowerCase().includes(currentSearchTerm.toLowerCase()))),filteredLocations=e,displayLocations(filteredLocations)}function initializeSearch(){const e=document.getElementById("searchInput");e&&(e.addEventListener("input",function(){currentSearchTerm=this.value.trim(),applyFilters()}),e.addEventListener("keypress",function(e){"Enter"===e.key&&(e.preventDefault(),applyFilters())}))}function initializeInteractions(){const e=document.querySelectorAll(".filter-btn"),t=document.getElementById("searchInput"),n=document.querySelector(".search-box");e.forEach(e=>{e.addEventListener("mouseenter",function(){this.classList.contains("active")||(this.style.transform="translateY(-2px)")}),e.addEventListener("mouseleave",function(){this.classList.contains("active")||(this.style.transform="translateY(0)")})}),t&&n&&(t.addEventListener("focus",function(){n.style.transform="translateY(-2px)"}),t.addEventListener("blur",function(){n.style.transform="translateY(0)"}));const a=document.querySelector(".back-button");a&&(a.addEventListener("mouseenter",function(){this.style.transform="translateY(-2px)"}),a.addEventListener("mouseleave",function(){this.style.transform="translateY(0)"}))}function createLoadingOverlay(){const e=document.createElement("div");return e.className="page-loading-overlay",e.id="pageLoadingOverlay",e.innerHTML='\n    <div class="loading-spinner-container">\n      <div class="modern-loading-spinner"></div>\n      <div class="loading-text">\n        Se încarcă<span class="loading-dots"></span>\n      </div>\n    </div>\n  ',document.body.appendChild(e),e}function showLoadingOverlay(){document.body.classList.add("loading"),document.body.classList.remove("loaded");let e=document.getElementById("pageLoadingOverlay");e||(e=createLoadingOverlay()),e.classList.remove("hidden")}function hideLoadingOverlay(){const e=document.getElementById("pageLoadingOverlay");e&&(e.classList.add("hidden"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},500)),document.body.classList.remove("loading"),document.body.classList.add("loaded")}function navigateWithLoading(e){clearTimeout(window.loadingTimeout),showLoadingOverlay(),window.location.href=e}function showLoadingOverlayImmediately(){document.body.classList.add("loading"),document.body.classList.remove("loaded");let e=document.getElementById("pageLoadingOverlay");e||(e=createLoadingOverlay()),e.classList.remove("hidden")}document.addEventListener("DOMContentLoaded",function(){try{const e=document.getElementById("immediateLoadingOverlay");e&&(e.id="pageLoadingOverlay"),initializeFiltering(),initializeSearch(),initializeInteractions(),loadLocations(),setTimeout(()=>{document.querySelectorAll('a[href*=".html"], .btn[href*=".html"], .back-button').forEach(e=>{e.addEventListener("click",function(e){const t=this.getAttribute("href");!t||!t.includes(".html")||t.startsWith("http")||t.startsWith("mailto")||t.startsWith("tel")||(e.preventDefault(),navigateWithLoading(t))})})},100)}catch(e){console.error("Rezervari page initialization error:",e),hideLoadingOverlay()}}),document.addEventListener("visibilitychange",function(){document.hidden||setTimeout(()=>{const e=document.getElementById("pageLoadingOverlay");e&&!e.classList.contains("hidden")&&hideLoadingOverlay()},100)}),window.addEventListener("pageshow",function(e){e.persisted&&hideLoadingOverlay()}),window.addEventListener("beforeunload",function(){showLoadingOverlay()});