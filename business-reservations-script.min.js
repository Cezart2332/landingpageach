document.addEventListener("DOMContentLoaded",()=>{const e=new URLSearchParams(location.search).get("id")||"1",t=document.getElementById("locName"),a=document.getElementById("statsRow"),n=document.getElementById("filterTabs"),s=document.getElementById("reservationsList"),i=document.getElementById("cancelModal"),c=document.getElementById("cancelReason"),l=document.getElementById("confirmCancelBtn");document.getElementById("locProfileBtn").addEventListener("click",()=>window.location.href="business-location.html?id="+e);const d={1:"Central Bistro",2:"Urban Roast",3:"Garden Lounge"}[e]||"Locație";t.textContent=d;let o=generateMock(),r="all",u=null;function generateMock(){return[{id:101,customerName:"Andrei Pop",date:"05 septembrie",time:"19:00",people:4,status:"confirmed",specialRequests:"Masă lângă geam",phone:"+40721222333"},{id:102,customerName:"Maria Ionescu",date:"06 septembrie",time:"20:30",people:2,status:"pending",specialRequests:"Aniversare",phone:"+40733444555"},{id:103,customerName:"John Doe",date:"06 septembrie",time:"18:00",people:6,status:"canceled",specialRequests:"",phone:"+40123456789"},{id:104,customerName:"Elena Radu",date:"07 septembrie",time:"21:15",people:3,status:"completed",specialRequests:"",phone:"+40766555444"},{id:105,customerName:"Matei Luca",date:"07 septembrie",time:"19:45",people:5,status:"pending",specialRequests:"Scaun pentru copil",phone:"+40712312312"}].map(e=>({...e,timestamp:Date.now()-Math.floor(5e6*Math.random())}))}function stats(){return{total:o.length,pending:o.filter(e=>"pending"===e.status).length,confirmed:o.filter(e=>"confirmed"===e.status).length,completed:o.filter(e=>"completed"===e.status).length,canceled:o.filter(e=>"canceled"===e.status).length}}function renderList(){const e=function(){const e=[...o].sort((e,t)=>{const a={pending:0,confirmed:1,completed:2,canceled:3};return a[e.status]!==a[t.status]?a[e.status]-a[t.status]:(t.timestamp||0)-(e.timestamp||0)});return"all"===r?e:e.filter(e=>e.status===r)}();if(!e.length)return s.innerHTML="<div class='empty-state'><div class='empty-icon'><i class=\"fas fa-calendar-xmark\"></i></div><h3 style='margin:0 0 8px;font-size:1.4rem;'>Nicio rezervare</h3><p style='margin:0 0 14px;color:#94a3b8;font-size:.85rem;'>Rezervările vor apărea aici pe măsură ce sunt create.</p><button class='reload-btn' id='reloadBtn'><i class=\"fas fa-rotate\"></i> Reîncarcă</button></div>",void document.getElementById("reloadBtn").addEventListener("click",()=>{o=generateMock(),render()});s.innerHTML=e.map(e=>function(e){return`<div class="reservation-card" data-id="${e.id}">\n      <div class="res-head">\n        <h3 class="res-name">${e.customerName}</h3>\n        <span class="${t=e.status,"chip "+t}">${e.status.toUpperCase()}</span>\n      </div>\n      <div class="res-grid">\n        <div class="res-meta"><h6>DATA</h6><span>${e.date}</span></div>\n        <div class="res-meta"><h6>ORA</h6><span>${e.time}</span></div>\n        <div class="res-meta"><h6>PERS</h6><span>${e.people}</span></div>\n        <div class="res-meta"><h6>ID</h6><span>#${e.id}</span></div>\n        <div class="res-meta"><h6>TELEFON</h6><span>${e.phone||"—"}</span></div>\n      </div>\n      ${e.specialRequests?`<div class="special-req"><i class="fas fa-comment-dots" style="opacity:.6;"></i> ${e.specialRequests}</div>`:""}\n      <div class="actions-row">\n        ${function(e){return"pending"===e.status?`<button class="act-btn green" data-act="confirm" data-id="${e.id}"><i class='fas fa-check'></i> Confirmă</button><button class="act-btn red" data-act="cancel" data-id="${e.id}"><i class='fas fa-xmark'></i> Respinge</button>`:"confirmed"===e.status?`<button class="act-btn blue" data-act="complete" data-id="${e.id}"><i class='fas fa-flag-checkered'></i> Finalizează</button><button class="act-btn red" data-act="cancel" data-id="${e.id}"><i class='fas fa-ban'></i> Anulează</button>`:'<button class="act-btn" disabled style="opacity:.4;cursor:not-allowed;"><i class=\'fas fa-info-circle\'></i> Fără acțiuni</button>'}(e)}\n      </div>\n    </div>`;var t}(e)).join(""),s.querySelectorAll("[data-act]").forEach(e=>e.addEventListener("click",handleAction))}function handleAction(e){const t=e.currentTarget,a=t.dataset.act,n=Number(t.dataset.id);"confirm"===a?updateStatus(n,"confirmed"):"complete"===a?updateStatus(n,"completed"):"cancel"===a&&(u=n,c.value="",i.style.display="flex")}function updateStatus(e,t,a){o=o.map(n=>n.id===e?{...n,status:t,cancelReason:a||n.cancelReason}:n),render()}function closeCancel(){i.style.display="none"}function render(){!function(){const e=stats();a.innerHTML=`\n      <div class="stat-box"><div class="stat-label">TOTAL</div><div class="stat-value">${e.total}</div></div>\n      <div class="stat-box amber"><div class="stat-label">ÎN AȘTEPTARE</div><div class="stat-value">${e.pending}</div></div>\n      <div class="stat-box green"><div class="stat-label">CONFIRMATE</div><div class="stat-value">${e.confirmed}</div></div>\n      <div class="stat-box"><div class="stat-label">FINALIZATE</div><div class="stat-value">${e.completed}</div></div>\n      <div class="stat-box"><div class="stat-label" style="color:#ef4444;">ANULATE</div><div class="stat-value" style="color:#ef4444;">${e.canceled}</div></div>`}(),function(){const e=stats(),t=[{id:"all",label:"Toate",count:e.total},{id:"pending",label:"În așteptare",count:e.pending},{id:"confirmed",label:"Confirmate",count:e.confirmed},{id:"completed",label:"Finalizate",count:e.completed},{id:"canceled",label:"Anulate",count:e.canceled}];n.innerHTML=t.map(e=>`<button type="button" class="filter-btn ${r===e.id?"active":""}" data-filter="${e.id}">${e.label} (${e.count})</button>`).join(""),n.querySelectorAll("[data-filter]").forEach(e=>e.addEventListener("click",()=>{r=e.dataset.filter,render()}))}(),renderList()}i.querySelectorAll("[data-close]").forEach(e=>e.addEventListener("click",closeCancel)),l.addEventListener("click",()=>{null!=u&&updateStatus(u,"canceled",c.value.trim()||"Fără motiv"),closeCancel(),u=null}),render()});