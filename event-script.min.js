const isLocalDev=["localhost","127.0.0.1"].includes(window.location.hostname),API_BASE_URL=isLocalDev?"/api":"https://api.acoomh.ro";let currentEvent=null,currentEventId=null;function createLoadingOverlay(){const e=document.createElement("div");return e.className="page-loading-overlay",e.id="pageLoadingOverlay",e.innerHTML='\n    <div class="loading-spinner-container">\n      <div class="modern-loading-spinner"></div>\n      <div class="loading-text">\n        Se încarcă<span class="loading-dots"></span>\n      </div>\n    </div>\n  ',document.body.appendChild(e),e}function showLoadingOverlay(){document.body.classList.add("loading"),document.body.classList.remove("loaded");let e=document.getElementById("pageLoadingOverlay");e||(e=createLoadingOverlay()),e.classList.remove("hidden")}function hideLoadingOverlay(){const e=document.getElementById("pageLoadingOverlay");e&&(e.style.transition="opacity 0.5s ease, visibility 0.5s ease",e.style.opacity="0",e.style.visibility="hidden",e.style.pointerEvents="none",setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},500)),document.body.classList.remove("loading"),document.body.classList.add("loaded")}function navigateWithLoading(e){clearTimeout(window.loadingTimeout),showLoadingOverlay(),window.location.href=e}async function loadEventDetails(e){try{const t=await fetchEventData(e);if(!t)throw new Error("Nu s-au primit detalii despre eveniment");currentEvent=t,populateEventDetails(t),setTimeout(()=>{hideLoadingOverlay(),setTimeout(()=>{document.body.classList.add("loaded")},100)},500)}catch(e){console.error("Error loading event details:",e),showError(`Nu am putut încărca datele evenimentului. ${e.message}`),hideLoadingOverlay()}}async function fetchEventData(e){const t=e||currentEventId||getEventId();if(!t)return console.warn("No event id found for fetchEventData"),null;try{const e=await fetch(`${API_BASE_URL}/events/${t}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!e.ok)return console.log("Failed to fetch event, status:",e.status),null;const n=await e.json();return console.log("Event data received:",{id:n.id||n.Id,title:n.title||n.name||n.Name,hasPhoto:!!(n.photo||n.Photo||n.photoUrl),photoLength:n.photo&&n.photo.length||0}),n}catch(e){return console.error("Error fetching event data:",e),null}}function formatDate(e){try{return new Date(e).toLocaleDateString("ro-RO",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}catch{return e||""}}function formatTime(e){if(!e)return"";const t=String(e).split(":"),n=parseInt(t[0],10),o=t[1]??"00",a=n>=12?"PM":"AM";return`${(n%12||12).toString()}:${o} ${a}`}function getEventId(){return new URLSearchParams(window.location.search).get("id")}function showError(e){showPopup("Eroare",e,"fas fa-exclamation-triangle")}function populateEventDetails(e){document.getElementById("eventName").textContent=e.Name||e.name||"Eveniment",document.getElementById("eventLocation").textContent=e.Location||e.location||"Locație necunoscută",document.getElementById("eventType").textContent=e.Category||e.category||"Eveniment",document.getElementById("eventPrice").textContent=e.Price||e.price||"Preț la cerere";const t=e.Date||e.date||e.eventDate,n=e.Time||e.time||e.eventTime;t&&(document.getElementById("eventDate").textContent=formatDate(t)),n&&(document.getElementById("eventTime").textContent=formatTime(n));const o=e.Description||e.description||`Descoperă ${e.Name||e.name||"acest eveniment"}, o experiență extraordinară care îți va oferi momente de neuitat. Alătură-te nouă pentru o seară plină de energie și divertisment în ${e.Location||e.location||"oraș"}.`;document.getElementById("eventDescription").textContent=o;const a=document.getElementById("eventImage");if(e.photoUrl)a.src=e.photoUrl,a.onerror=()=>setDefaultEventImage(a,e.Category||e.category);else{const t=e.Photo||e.photo;if(t)try{let n;if("string"==typeof t)n="use_photo_url"===t?e.photoUrl:t.startsWith("data:")||t.startsWith("http")?t:`data:image/jpeg;base64,${t}`;else if(Array.isArray(t)&&t.length>0){n=`data:image/jpeg;base64,${btoa(String.fromCharCode.apply(null,t))}`}n?(a.src=n,a.onerror=()=>setDefaultEventImage(a,e.Category||e.category)):setDefaultEventImage(a,e.Category||e.category)}catch(t){console.error("Error processing image:",t),setDefaultEventImage(a,e.Category||e.category)}else setDefaultEventImage(a,e.Category||e.category)}a.alt=e.Name||e.name||"Event";const i=document.getElementById("eventTags");i.innerHTML="";const r=e.category||e.Category||"Event",c=document.createElement("span");c.className="event-tag primary";const s=getEventCategoryIcon(r),l=document.createElement("i");l.className=s,c.appendChild(l),c.appendChild(document.createTextNode(` ${r}`)),i.appendChild(c);const d=e.tags;if(d&&Array.isArray(d)&&d.length>0){const e=d.filter(e=>e&&e.trim().length>0);e.slice(0,4).forEach(e=>{const t=document.createElement("span");t.className="event-tag",t.textContent=e,i.appendChild(t)}),console.log("✅ Tags processed from API:",e)}if(populateEventSchedule(e),populateEventFeatures(e),e.Contact&&e.Contact.phone){const t=document.getElementById("eventPhone");t&&(t.textContent=e.Contact.phone,t.href=`tel:${e.Contact.phone.replace(/\s/g,"")}`)}else if(e.phone){const t=document.getElementById("eventPhone");t&&(t.textContent=e.phone,t.href=`tel:${e.phone.replace(/\s/g,"")}`)}else{const e=document.getElementById("eventPhone");if(e){const t=e.closest(".info-item");t&&(t.style.display="none")}}document.title=`${e.Name||e.name||"Eveniment"} - AcoomH`,console.log("✅ Event details populated successfully:",e)}function populateEventSchedule(e){const t=document.getElementById("eventSchedule");if(!t)return void console.warn("Schedule container not found");t.innerHTML="";const n=document.createElement("div");n.className="schedule-item";const o=e.Date||e.date||e.eventDate,a=e.Time||e.time||e.eventTime,i=o?formatDate(o):"Se anunță data",r=a?formatTime(a):"Se anunță ora";if(n.innerHTML=`\n    <span class="schedule-day">Data evenimentului</span>\n    <span class="schedule-hours">${i}</span>\n  `,t.appendChild(n),a){const e=document.createElement("div");e.className="schedule-item",e.innerHTML=`\n      <span class="schedule-day">Ora începerii</span>\n      <span class="schedule-hours">${r}</span>\n    `,t.appendChild(e)}}function populateEventFeatures(e){const t=document.getElementById("eventFeatures");t.innerHTML="";[{icon:"fas fa-ticket-alt",name:"Bilete online"},{icon:"fas fa-credit-card",name:"Plată cu cardul"},...{concert:[{icon:"fas fa-music",name:"Muzică live"},{icon:"fas fa-volume-up",name:"Sunet profesional"}],festival:[{icon:"fas fa-users",name:"Mulțime de oameni"},{icon:"fas fa-utensils",name:"Zone food"}],teatru:[{icon:"fas fa-theater-masks",name:"Spectacol live"},{icon:"fas fa-chair",name:"Locuri rezervate"}],"conferință":[{icon:"fas fa-microphone",name:"Prezentări"},{icon:"fas fa-wifi",name:"WiFi gratuit"}],sport:[{icon:"fas fa-trophy",name:"Competiție"},{icon:"fas fa-tv",name:"Ecrane mari"}]}[e.category&&"string"==typeof e.category?e.category.toLowerCase():"eveniment"]||[]].forEach(e=>{const n=document.createElement("div");n.className="feature-item",n.innerHTML=`\n      <i class="${e.icon}"></i>\n      <span>${e.name}</span>\n    `,t.appendChild(n)})}function getEventCategoryIcon(e){if(!e||"string"!=typeof e)return"fas fa-calendar-alt";return{concert:"fas fa-music",festival:"fas fa-star",teatru:"fas fa-theater-masks","conferință":"fas fa-microphone",sport:"fas fa-trophy",club:"fas fa-cocktail",party:"fas fa-glass-cheers"}[e.toLowerCase()]||"fas fa-calendar-alt"}function setDefaultEventImage(e,t){const n={concert:"https://images.unsplash.com/photo-1501386761578-eac5c94b800a?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",festival:"https://images.unsplash.com/photo-1459749411175-04bf5292ceea?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",teatru:"https://images.unsplash.com/photo-1507924538820-ede94a04019d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80","conferință":"https://images.unsplash.com/photo-1505373877841-8d25f7d46678?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",sport:"https://images.unsplash.com/photo-1540747913346-19e32dc3e97e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",club:"https://images.unsplash.com/photo-1571266028243-d220c9f3e821?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"},o=t&&"string"==typeof t?t.toLowerCase():"concert";e.src=n[o]||n.concert}function initializeTicketForm(){console.log("Ticket reservation form initialized")}function validateTicketForm(){const e=document.getElementById("fullName").value.trim(),t=document.getElementById("phoneNumber").value.trim(),n=document.getElementById("email").value.trim(),o=document.getElementById("ticketCount").value,a=document.getElementById("ticketType").value,i=[];return e?e.length<2&&i.push("Numele trebuie să aibă cel puțin 2 caractere"):i.push("Introdu numele tău complet"),t?/^(\+4|4|0)?\d{9}$/.test(t.replace(/\s/g,""))||i.push("Numărul de telefon nu este valid (ex: 0721234567)"):i.push("Introdu numărul de telefon"),n?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)||i.push("Adresa de email nu este validă"):i.push("Introdu adresa de email"),o||i.push("Selectează numărul de bilete"),a||i.push("Selectează tipul de bilet"),{isValid:0===i.length,errors:i}}function showPopup(e,t,n="fas fa-info-circle",o=!1){document.querySelectorAll(".popup-overlay").forEach(e=>e.remove());const a=document.createElement("div");a.className="popup-overlay";const i=document.createElement("div");function closePopup(){a.style.opacity="0",i.style.transform="scale(0.8) translateY(20px)",setTimeout(()=>{document.body.contains(a)&&document.body.removeChild(a)},300)}i.className="popup-content",i.innerHTML=`\n    <div style="margin-bottom: 25px;">\n      <i class="${n}" style="font-size: 3rem; color: ${o?"var(--success-color)":"var(--event-color)"}; margin-bottom: 20px; display: block;"></i>\n      <h3>${e}</h3>\n      <p>${t}</p>\n    </div>\n    <button class="popup-close-btn">\n      <i class="fas fa-check" style="margin-right: 8px;"></i>\n      Înțeles!\n    </button>\n  `,i.querySelector(".popup-close-btn").addEventListener("click",closePopup),a.addEventListener("click",e=>{e.target===a&&closePopup()});const escapeHandler=e=>{"Escape"===e.key&&(closePopup(),document.removeEventListener("keydown",escapeHandler))};document.addEventListener("keydown",escapeHandler),a.appendChild(i),document.body.appendChild(a),setTimeout(()=>{a.style.opacity="1",i.style.transform="scale(1) translateY(0)"},10)}function setupFormValidation(){document.querySelectorAll(".form-input").forEach(e=>{e.addEventListener("blur",function(){validateInput(this)}),e.addEventListener("input",function(){this.classList.contains("error")&&validateInput(this)})})}function validateInput(e){const t=e.value;let n=!0,o="";e.hasAttribute("required")&&!t?(n=!1,o="Acest câmp este obligatoriu"):"email"===e.type&&t&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||(n=!1,o="Adresa de email nu este validă"));const a=e.parentNode.querySelector(".error-message");if(a&&a.remove(),e.classList.remove("success","error"),n)t&&e.classList.add("success");else{e.classList.add("error");const t=document.createElement("div");t.className="error-message",t.textContent=o,e.parentNode.appendChild(t)}return n}function getCurrentEvent(){if(currentEvent){let e="N/A";return currentEvent.Contact&&currentEvent.Contact.phone?e=currentEvent.Contact.phone:currentEvent.phone&&(e=currentEvent.phone),{name:currentEvent.name||currentEvent.Name||"Eveniment",location:currentEvent.location||currentEvent.Location||"",phone:e,type:currentEvent.category||currentEvent.Category||"Eveniment"}}return{name:"Eveniment",location:"",phone:"N/A",type:"Eveniment"}}function initializeAnimations(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=document.querySelector(this.getAttribute("href"));t&&t.scrollIntoView({behavior:"smooth",block:"start"})})});const e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("animate-in")})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".event-section, .info-section, .reservation-section").forEach(t=>e.observe(t))}function initializeNavbar(){const e=document.querySelector(".navbar");if(e){let t=window.scrollY;window.addEventListener("scroll",()=>{const n=window.scrollY;n>100?e.classList.add("scrolled"):e.classList.remove("scrolled"),n>t&&n>200?e.classList.add("hidden"):e.classList.remove("hidden"),t=n})}}function initializeAll(){initializeTicketForm(),setupFormValidation(),initializeAnimations(),initializeNavbar()}document.addEventListener("DOMContentLoaded",function(){try{document.body.classList.add("loading"),document.body.classList.remove("loaded");const e=document.getElementById("immediateLoadingOverlay");e&&(e.id="pageLoadingOverlay",e.style.opacity="1",e.style.visibility="visible");const t=getEventId();if(currentEventId=t,!t)return showError("ID-ul evenimentului nu a fost găsit în URL."),void hideLoadingOverlay();loadEventDetails(t),initializeAll(),"#reservation"===window.location.hash&&setTimeout(()=>{const e=document.querySelector(".reservation-section");e&&e.scrollIntoView({behavior:"smooth"})},1500),setTimeout(()=>{document.querySelectorAll('a[href*=".html"], .btn[href*=".html"], .back-button, .btn-back').forEach(e=>{e.addEventListener("click",function(e){const t=this.getAttribute("href")||this.getAttribute("onclick");if(this.hasAttribute("onclick")){if(this.getAttribute("onclick").includes("goBack()"))return e.preventDefault(),void navigateWithLoading("index.html")}!t||!t.includes(".html")||t.startsWith("http")||t.startsWith("mailto")||t.startsWith("tel")||(e.preventDefault(),navigateWithLoading(t))})})},100)}catch(e){console.error("Events page initialization error:",e),showError("A apărut o problemă la încărcarea paginii."),hideLoadingOverlay()}}),document.addEventListener("visibilitychange",function(){document.hidden||setTimeout(()=>{const e=document.getElementById("pageLoadingOverlay");e&&!e.classList.contains("hidden")&&hideLoadingOverlay()},100)}),window.addEventListener("pageshow",function(e){e.persisted&&hideLoadingOverlay()}),window.addEventListener("beforeunload",function(){showLoadingOverlay()}),window.refreshEvent=async function(){try{showLoadingOverlay();const e=await fetchEventData();e&&(currentEvent=e,populateEventDetails(e))}finally{hideLoadingOverlay()}},window.deleteEvent=function(){const e=currentEventId||getEventId();if(!e)return;confirm("Ești sigur că vrei să ștergi acest eveniment? Această acțiune nu poate fi anulată.")&&(async()=>{try{(await fetch(`${API_BASE_URL}/events/${e}`,{method:"DELETE"})).ok?(alert("Eveniment șters cu succes"),document.referrer&&document.referrer.includes(window.location.origin)?history.back():window.location.href="events.html"):alert("Eroare: nu s-a putut șterge evenimentul")}catch(e){console.error("Error deleting event:",e),alert("Eroare: nu s-a putut șterge evenimentul")}})()},window.reserveTickets=async function(){const e=validateTicketForm();if(!e.isValid)return void showPopup("Formular incomplet",e.errors.join("<br>"),"fas fa-exclamation-triangle");if(!currentEvent)return void showPopup("Eroare","Datele evenimentului nu sunt disponibile. Te rugăm să reîmprospătezi pagina.","fas fa-exclamation-triangle");const t=document.getElementById("fullName").value.trim(),n=document.getElementById("phoneNumber").value.trim(),o=document.getElementById("email").value.trim(),a=document.getElementById("ticketCount").value,i=document.getElementById("ticketType").value,r={customerName:t,customerEmail:o,customerPhone:n,numberOfTickets:parseInt(a),ticketType:i,eventId:parseInt(currentEvent.id),specialRequests:"",status:"Pending"},c=document.querySelector(".btn-rezerva"),s=c.innerHTML;c.disabled=!0,c.innerHTML='<div class="loading"></div> Se procesează...';try{await reserveTickets(r);c.disabled=!1,c.innerHTML=s;const e=currentEvent.name||currentEvent.Name||"Eveniment";showPopup("Rezervare confirmată!",`Mulțumim, <strong>${t}</strong>!<br><br>Rezervarea pentru <strong>${a} ${"1"===a?"bilet":"bilete"}</strong> la evenimentul <strong>${e}</strong> a fost trimisă!<br><br>Vei fi contactat în curând pentru confirmare și detalii de plată.`,"fas fa-check-circle",!0),document.getElementById("fullName").value="",document.getElementById("phoneNumber").value="",document.getElementById("email").value="",document.getElementById("ticketCount").value="",document.getElementById("ticketType").value=""}catch(e){c.disabled=!1,c.innerHTML=s,showPopup("Eroare la rezervare",e.message||"Nu am putut procesa rezervarea. Te rugăm să încerci din nou.","fas fa-exclamation-triangle")}},window.getDirections=function(){const e=getCurrentEvent();if(e.location){const t=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e.location)}`;window.open(t,"_blank")}},window.openMaps=function(){const e=getCurrentEvent();if(e.location){const t=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e.location)}`;window.open(t,"_blank")}},window.shareEvent=function(){const e=getCurrentEvent(),t={title:e.name,text:`Descoperă ${e.name} pe AcoomH!`,url:window.location.href};function fallbackShare(){navigator.clipboard.writeText(window.location.href).then(()=>{showPopup("Link copiat!","Link-ul către eveniment a fost copiat în clipboard.","fas fa-copy",!0)}).catch(()=>{showPopup("Partajare",`Copiază acest link pentru a partaja evenimentul:<br><br><code style="background: var(--bg-dark); padding: 8px; border-radius: 6px; font-size: 0.8rem; word-break: break-all;">${window.location.href}</code>`,"fas fa-share-alt")})}navigator.share?navigator.share(t).catch(e=>{console.log("Error sharing:",e),fallbackShare()}):fallbackShare()},window.goBack=function(){document.referrer&&document.referrer.includes(window.location.origin)?history.back():window.location.href="index.html"},initializeAll(),window.addEventListener("load",function(){document.body.classList.add("loaded")}),console.log("Events page initialized successfully");