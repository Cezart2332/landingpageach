document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("daysWrap"),t=document.getElementById("saveHoursBtn"),a=new URLSearchParams(location.search).get("id"),n=document.getElementById("locNameSub"),l=document.getElementById("quickActions"),s=a?"1"==a?"Central Bistro":"2"==a?"Urban Roast":"Garden Lounge":"Locație";n.textContent=s;const i=[{value:0,label:"Duminică"},{value:1,label:"Luni"},{value:2,label:"Marți"},{value:3,label:"Miercuri"},{value:4,label:"Joi"},{value:5,label:"Vineri"},{value:6,label:"Sâmbătă"}];let d=i.map(e=>({day:e.value,isOpen:!0,is24:!1,open:"09:00",close:"22:00"})),c=!1;function markDirty(){c=!0,t.disabled=!1}function formatDisp(e){const[t,a]=e.split(":"),n=parseInt(t,10);return`${n%12||12}:${a} ${n>=12?"PM":"AM"}`}function render(){e.innerHTML=d.map(e=>function(e){return`<div class="day-card" data-day="${e.day}">\n      <div class="day-head">\n        <h4>${i.find(t=>t.value===e.day).label}</h4>\n        <label class="switch"><input type="checkbox" data-open-toggle ${e.isOpen?"checked":""}><span class="slider"></span></label>\n      </div>\n      <div class="day-body">${e.isOpen?function(e){return`<div class="block">\n        <label>24H NON‑STOP</label>\n        <button type="button" class="toggle-24 ${e.is24?"active":""}" data-24>${e.is24?'<i class="fas fa-check"></i> Activ':"Activează"}</button>\n      </div>\n      ${e.is24?"":`<div class="block">\n        <label>DESCHIDE</label>\n        <button type="button" class="time-btn" data-time="open"> <i class="fas fa-clock"></i> ${formatDisp(e.open)}</button>\n      </div>\n      <div class="block">\n        <label>ÎNCHIDE</label>\n        <button type="button" class="time-btn" data-time="close"> <i class="fas fa-clock"></i> ${formatDisp(e.close)}</button>\n      </div>`}`}(e):"<div class='closed-label'>ÎNCHIS</div>"}</div>\n    </div>`}(e)).join(""),e.querySelectorAll("[data-open-toggle]").forEach(e=>{e.addEventListener("change",e=>{const t=e.target.closest(".day-card"),a=Number(t.dataset.day),n=d.find(e=>e.day===a);n.isOpen=e.target.checked,n.isOpen||(n.is24=!1),markDirty(),render()})}),e.querySelectorAll("[data-24]").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.closest(".day-card"),a=Number(t.dataset.day),n=d.find(e=>e.day===a);n.is24=!n.is24,n.is24&&(n.open="00:00",n.close="23:59"),markDirty(),render()})}),e.querySelectorAll("[data-time]").forEach(e=>{e.addEventListener("click",t=>{const a=t.target.closest(".day-card");!function(e,t){m.day=e,m.field=t,m.value=null,function(){r.innerHTML="";const e=new Date;e.setHours(0,0,0,0);for(let t=0;t<48;t++){const a=new Date(e.getTime()+30*t*6e4),n=`${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`,l=m.value===n,s=document.createElement("div");s.className="tm-item"+(l?" active":""),s.innerHTML=`<span>${formatDisp(n)}</span><i class="fas fa-clock" style="opacity:.4;"></i>`,s.dataset.val=n,s.addEventListener("click",()=>{m.value=n,r.querySelectorAll(".tm-item").forEach(e=>e.classList.toggle("active",e.dataset.val===n))}),r.appendChild(s)}}(),document.getElementById("tmTitle").textContent="Selectează ora de "+("open"===t?"deschidere":"închidere"),o.style.display="flex"}(Number(a.dataset.day),e.getAttribute("data-time"))})})}l.querySelectorAll("[data-action]").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.action;"nonstop"===t?d=d.map(e=>({...e,isOpen:!0,is24:!0,open:"00:00",close:"23:59"})):"openall"===t?d=d.map(e=>({...e,isOpen:!0,is24:!1,open:"09:00",close:"22:00"})):"closeall"===t?d=d.map(e=>({...e,isOpen:!1,is24:!1})):"weekdays"===t?d=d.map(e=>({...e,isOpen:e.day>=1&&e.day<=5,is24:!1,open:"09:00",close:"18:00"})):"weekend"===t&&(d=d.map(e=>({...e,isOpen:0===e.day||6===e.day,is24:!1,open:"10:00",close:"23:00"}))),markDirty(),render()})});const o=document.getElementById("timeModal"),r=document.getElementById("tmList"),u=document.getElementById("tmConfirm");let m={day:null,field:null,value:null};u.addEventListener("click",()=>{if(!m.value)return void alert("Selectează o oră.");const e=d.find(e=>e.day===m.day);"open"===m.field?e.open=m.value:e.close=m.value,markDirty(),o.style.display="none",render()}),o.querySelectorAll("[data-close]").forEach(e=>e.addEventListener("click",()=>{o.style.display="none"})),t.addEventListener("click",()=>{if(t.disabled)return;t.disabled=!0;const e=t.querySelector("span");e.textContent="Se salvează...",setTimeout(()=>{c=!1,e.textContent="Program Salvat",t.innerHTML='<i class="fas fa-check"></i> <span>Program Salvat</span>',setTimeout(()=>{t.innerHTML='<i class="fas fa-save"></i> <span>Salvează Program</span>',t.disabled=!0},2600)},900)}),render()});