const isLocalDev="undefined"!=typeof window&&("localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname),API_BASE_URL=isLocalDev?"/api":"https://api.acoomh.ro";let allLocations=[],filteredLocations=[],currentFilter="all",currentSearchTerm="";const DOM={loadingState:null,errorState:null,locationsContainer:null,emptyResults:null,locationsGrid:null,errorMessage:null,searchInput:null};function initializeDOM(){DOM.loadingState=document.getElementById("loadingState"),DOM.errorState=document.getElementById("errorState"),DOM.locationsContainer=document.getElementById("locationsContainer"),DOM.emptyResults=document.getElementById("emptyResults"),DOM.locationsGrid=document.getElementById("locationsGrid"),DOM.errorMessage=document.getElementById("errorMessage"),DOM.searchInput=document.getElementById("searchInput")}async function loadLocations(){showLoadingState();try{const t=await fetch(`${API_BASE_URL}/locations`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json(),n=e.data||e||[];if(!Array.isArray(n))throw new Error("Răspunsul API-ului nu conține un array valid de locații");allLocations=n,filteredLocations=n,displayLocations(filteredLocations),hideLoadingState(),hideLoadingOverlay(),console.log("✅ Successfully loaded locations from API:",n.length)}catch(t){console.error("Error loading locations from API:",t),showErrorState(`Nu am putut încărca locațiile. ${t.message}`),hideLoadingOverlay()}}function showLoadingState(){DOM.loadingState.style.display="block",DOM.errorState.style.display="none",DOM.locationsContainer.style.display="none",DOM.emptyResults.style.display="none"}function showErrorState(t){DOM.loadingState.style.display="none",DOM.errorState.style.display="block",DOM.locationsContainer.style.display="none",DOM.emptyResults.style.display="none",DOM.errorMessage.textContent=t||"Nu am putut încărca locațiile disponibile."}function hideLoadingState(){DOM.loadingState.style.display="none",DOM.errorState.style.display="none"}function displayLocations(t){if(!t||0===t.length)return DOM.locationsContainer.style.display="none",void(DOM.emptyResults.style.display="block");DOM.locationsContainer.style.display="block",DOM.emptyResults.style.display="none";const e=document.createDocumentFragment();t.forEach(t=>{const n=createLocationCard(t);e.appendChild(n)}),DOM.locationsGrid.innerHTML="",DOM.locationsGrid.appendChild(e)}function getOptimizedImageUrl(t){const e="https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80";if(t.photoUrl)return t.photoUrl;if(!t.photo)return e;try{return"string"==typeof t.photo?"use_photo_url"===t.photo?t.photoUrl||e:t.photo.startsWith("data:image/")||t.photo.startsWith("http")?t.photo:`data:image/jpeg;base64,${t.photo}`:e}catch(n){return console.warn("Error processing image for location:",t.id),e}}function createLocationCard(t){const e=document.createElement("div");e.className="location-card",e.setAttribute("data-location-id",t.id);let n=[];t.tags&&("string"==typeof t.tags?n=t.tags.split(",").map(t=>t.trim()).filter(Boolean):Array.isArray(t.tags)&&(n=t.tags.map(t=>String(t).trim()).filter(Boolean)));const a=getOptimizedImageUrl(t);return e.innerHTML=`\n    <div class="location-image">\n      <img src="${a}" alt="${t.name}" loading="lazy" onerror="this.src='${getOptimizedImageUrl({})}'" />\n      <div class="location-category">${getCategoryIcon(t.category)} ${t.category}</div>\n    </div>\n    <div class="location-content">\n      <h3 class="location-name">${t.name}</h3>\n      <p class="location-address">\n        <i class="fas fa-map-marker-alt"></i>\n        ${t.address}\n      </p>\n      ${n.length>0?`\n        <div class="location-tags">\n          ${n.slice(0,3).map(t=>`<span class="location-tag">${t}</span>`).join("")}\n          ${n.length>3?`<span class="location-tag-more">+${n.length-3}</span>`:""}\n        </div>\n      `:""}\n      <div class="location-actions">\n        <button class="btn-view-details" data-location-id="${t.id}">\n          <i class="fas fa-eye"></i>\n          Vezi detalii\n        </button>\n        <button class="btn-reserve" data-location-id="${t.id}">\n          <i class="fas fa-calendar-check"></i>\n          Rezervă\n        </button>\n      </div>\n    </div>\n  `,e.addEventListener("click",function(e){console.log("Card clicked!",{locationId:t.id,target:e.target}),handleCardClick(e,t.id)}),e}function handleCardClick(t,e){const n=e||t.target.closest("[data-location-id]")?.dataset.locationId;console.log("handleCardClick called",{finalLocationId:n,target:t.target.tagName}),n?t.target.closest(".btn-view-details")?(console.log("Clicked Vezi detalii button"),t.preventDefault(),t.stopPropagation(),navigateToLocation(n)):t.target.closest(".btn-reserve")?(console.log("Clicked Rezervă button"),t.preventDefault(),t.stopPropagation(),navigateToReservation(n)):t.target.closest("button")||(console.log("Clicked somewhere else on card - navigating to restaurant"),t.preventDefault(),t.stopPropagation(),navigateToLocation(n)):console.warn("No locationId found!")}function navigateToLocation(t){showLoadingOverlayImmediately(),window.location.href=`restaurant.html?id=${t}`}function navigateToReservation(t){showLoadingOverlayImmediately(),window.location.href=`restaurant.html?id=${t}#reservation`}function getCategoryIcon(t){return`<i class="${{restaurant:"fas fa-utensils",cafe:"fas fa-coffee",pub:"fas fa-beer",club:"fas fa-music",bar:"fas fa-cocktail"}[t.toLowerCase()]||"fas fa-store"}"></i>`}function openLocationDetails(t){window.location.href=`restaurant.html?id=${t}`}function quickReserve(t){window.location.href=`restaurant.html?id=${t}#reservation`}function initializeFiltering(){const t=document.querySelectorAll(".filter-btn");t.forEach(e=>{e.addEventListener("click",function(){t.forEach(t=>{t.classList.remove("active"),t.hasAttribute("role")&&t.setAttribute("aria-selected","false")}),this.classList.add("active"),this.hasAttribute("role")&&this.setAttribute("aria-selected","true"),currentFilter=this.dataset.type,applyFilters()})}),t.forEach(t=>{const e=t.classList.contains("active");t.hasAttribute("role")&&t.setAttribute("aria-selected",e?"true":"false")})}function applyFilters(){let t=[...allLocations];if("all"!==currentFilter){const e={restaurants:["restaurant","restaurante"],cafes:["cafe","cafenea","coffee"],pubs:["pub","brewery"],clubs:["club","nightclub","disco"]}[currentFilter]||[currentFilter];t=t.filter(t=>e.some(e=>t.category&&t.category.toLowerCase().includes(e.toLowerCase())))}currentSearchTerm&&(t=t.filter(t=>{const e=currentSearchTerm.toLowerCase(),n=t.name&&t.name.toLowerCase().includes(e)||t.address&&t.address.toLowerCase().includes(e)||t.category&&t.category.toLowerCase().includes(e);let a=!1;return t.tags&&("string"==typeof t.tags?a=t.tags.toLowerCase().includes(e):Array.isArray(t.tags)&&(a=t.tags.some(t=>String(t).toLowerCase().includes(e)))),n||a})),filteredLocations=t,displayLocations(filteredLocations)}function initializeSearch(){const t=document.getElementById("searchInput");t&&(t.addEventListener("input",function(){currentSearchTerm=this.value.trim(),applyFilters()}),t.addEventListener("keypress",function(t){"Enter"===t.key&&(t.preventDefault(),applyFilters())}))}function initializeInteractions(){const t=document.querySelectorAll(".filter-btn"),e=document.getElementById("searchInput"),n=document.querySelector(".search-box");t.forEach(t=>{t.addEventListener("mouseenter",function(){this.classList.contains("active")||(this.style.transform="translateY(-2px)")}),t.addEventListener("mouseleave",function(){this.classList.contains("active")||(this.style.transform="translateY(0)")})}),e&&n&&(e.addEventListener("focus",function(){n.style.transform="translateY(-2px)"}),e.addEventListener("blur",function(){n.style.transform="translateY(0)"}));const a=document.querySelector(".back-button");a&&(a.addEventListener("mouseenter",function(){this.style.transform="translateY(-2px)"}),a.addEventListener("mouseleave",function(){this.style.transform="translateY(0)"}))}function createLoadingOverlay(){const t=document.createElement("div");return t.className="page-loading-overlay",t.id="pageLoadingOverlay",t.innerHTML='\n    <div class="loading-spinner-container">\n      <div class="modern-loading-spinner"></div>\n      <div class="loading-text">\n        Se încarcă<span class="loading-dots"></span>\n      </div>\n    </div>\n  ',document.body.appendChild(t),t}function showLoadingOverlay(){document.body.classList.add("loading"),document.body.classList.remove("loaded");let t=document.getElementById("pageLoadingOverlay");t||(t=createLoadingOverlay()),t.classList.remove("hidden")}function hideLoadingOverlay(){const t=document.getElementById("pageLoadingOverlay");t&&(t.classList.add("hidden"),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},500)),document.body.classList.remove("loading"),document.body.classList.add("loaded"),document.body.style.pointerEvents="auto"}function navigateWithLoading(t){clearTimeout(window.loadingTimeout),showLoadingOverlay(),window.location.href=t}function showLoadingOverlayImmediately(){document.body.classList.add("loading"),document.body.classList.remove("loaded");let t=document.getElementById("pageLoadingOverlay");t||(t=createLoadingOverlay()),t.classList.remove("hidden")}document.addEventListener("DOMContentLoaded",function(){try{initializeDOM(),document.body.style.pointerEvents="auto";const t=document.getElementById("immediateLoadingOverlay");t&&(t.id="pageLoadingOverlay"),initializeFiltering(),initializeSearch(),initializeInteractions(),loadLocations(),requestAnimationFrame(setupNavigationHandlers)}catch(t){console.error("Rezervari page initialization error:",t),hideLoadingOverlay()}}),document.addEventListener("visibilitychange",function(){document.hidden||setTimeout(()=>{const t=document.getElementById("pageLoadingOverlay");t&&!t.classList.contains("hidden")&&hideLoadingOverlay()},100)}),window.addEventListener("pageshow",function(t){t.persisted&&hideLoadingOverlay()}),window.addEventListener("beforeunload",function(){showLoadingOverlay()});