const API_BASE_URL="https://api.acoomh.ro";let allLocations=[],filteredLocations=[],currentFilter="all",currentSearchTerm="";async function loadLocations(){showLoadingState();try{const t=await fetch(`${API_BASE_URL}/locations`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();allLocations=e,filteredLocations=e,displayLocations(filteredLocations),hideLoadingState(),console.log("✅ Successfully loaded locations from API:",e.length)}catch(t){console.error("Error loading locations from API:",t),showErrorState(`Nu am putut încărca locațiile. ${t.message}`)}}function showLoadingState(){document.getElementById("loadingState").style.display="block",document.getElementById("errorState").style.display="none",document.getElementById("locationsContainer").style.display="none",document.getElementById("emptyResults").style.display="none"}function showErrorState(t){document.getElementById("loadingState").style.display="none",document.getElementById("errorState").style.display="block",document.getElementById("locationsContainer").style.display="none",document.getElementById("emptyResults").style.display="none",document.getElementById("errorMessage").textContent=t||"Nu am putut încărca locațiile disponibile."}function hideLoadingState(){document.getElementById("loadingState").style.display="none",document.getElementById("errorState").style.display="none"}function displayLocations(t){const e=document.getElementById("locationsGrid"),n=document.getElementById("locationsContainer"),a=document.getElementById("emptyResults");if(!t||0===t.length)return n.style.display="none",void(a.style.display="block");n.style.display="block",a.style.display="none",e.innerHTML="",t.forEach(t=>{const n=createLocationCard(t);e.appendChild(n)})}function createLocationCard(t){const e=document.createElement("div");e.className="location-card";const n=t.tags&&"string"==typeof t.tags?t.tags.split(",").map(t=>t.trim()).filter(t=>t):[];let a="https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80";if(t.photo)try{if("string"==typeof t.photo)a=t.photo.startsWith("data:image/")||t.photo.startsWith("http")?t.photo:`data:image/jpeg;base64,${t.photo}`;else if(Array.isArray(t.photo)&&t.photo.length>0){a=`data:image/jpeg;base64,${arrayBufferToBase64(t.photo)}`}else if(t.photo.constructor===ArrayBuffer||t.photo.buffer){a=`data:image/jpeg;base64,${arrayBufferToBase64(new Uint8Array(t.photo))}`}}catch(e){console.error("Error processing image for location:",t.id,e)}e.innerHTML=`\n    <div class="location-image">\n      <img src="${a}" alt="${t.name}" onerror="this.src='https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80'">\n      <div class="location-category">${getCategoryIcon(t.category)} ${t.category}</div>\n    </div>\n    <div class="location-content">\n      <h3 class="location-name">${t.name}</h3>\n      <p class="location-address">\n        <i class="fas fa-map-marker-alt"></i>\n        ${t.address}\n      </p>\n      ${n.length>0?`\n        <div class="location-tags">\n          ${n.slice(0,3).map(t=>`<span class="location-tag">${t}</span>`).join("")}\n          ${n.length>3?`<span class="location-tag-more">+${n.length-3}</span>`:""}\n        </div>\n      `:""}\n      <div class="location-actions">\n        <button class="btn-view-details" data-location-id="${t.id}">\n          <i class="fas fa-eye"></i>\n          Vezi detalii\n        </button>\n        <button class="btn-reserve" data-location-id="${t.id}">\n          <i class="fas fa-calendar-check"></i>\n          Rezervă\n        </button>\n      </div>\n    </div>\n  `;const o=e.querySelector(".btn-view-details"),i=e.querySelector(".btn-reserve");return o.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),navigateWithLoading(`restaurant.html?id=${t.id}`)}),i.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),navigateWithLoading(`restaurant.html?id=${t.id}#reservation`)}),e.addEventListener("click",function(e){e.target.closest(".btn-view-details")||e.target.closest(".btn-reserve")||navigateWithLoading(`restaurant.html?id=${t.id}`)}),e}function getCategoryIcon(t){return`<i class="${{restaurant:"fas fa-utensils",cafe:"fas fa-coffee",pub:"fas fa-beer",club:"fas fa-music",bar:"fas fa-cocktail"}[t.toLowerCase()]||"fas fa-store"}"></i>`}function arrayBufferToBase64(t){let e="";const n=new Uint8Array(t),a=n.byteLength;for(let t=0;t<a;t++)e+=String.fromCharCode(n[t]);return window.btoa(e)}function openLocationDetails(t){window.location.href=`restaurant.html?id=${t}`}function quickReserve(t){window.location.href=`restaurant.html?id=${t}#reservation`}function initializeFiltering(){const t=document.querySelectorAll(".filter-btn");t.forEach(e=>{e.addEventListener("click",function(){t.forEach(t=>t.classList.remove("active")),this.classList.add("active"),currentFilter=this.dataset.type,applyFilters()})})}function applyFilters(){let t=[...allLocations];if("all"!==currentFilter){const e={restaurants:["restaurant","restaurante"],cafes:["cafe","cafenea","coffee"],pubs:["pub","brewery"],clubs:["club","nightclub","disco"]}[currentFilter]||[currentFilter];t=t.filter(t=>e.some(e=>t.category.toLowerCase().includes(e.toLowerCase())))}currentSearchTerm&&(t=t.filter(t=>t.name.toLowerCase().includes(currentSearchTerm.toLowerCase())||t.address.toLowerCase().includes(currentSearchTerm.toLowerCase())||t.category.toLowerCase().includes(currentSearchTerm.toLowerCase())||t.tags&&t.tags.toLowerCase().includes(currentSearchTerm.toLowerCase()))),filteredLocations=t,displayLocations(filteredLocations)}function initializeSearch(){const t=document.getElementById("searchInput");t&&(t.addEventListener("input",function(){currentSearchTerm=this.value.trim(),applyFilters()}),t.addEventListener("keypress",function(t){"Enter"===t.key&&(t.preventDefault(),applyFilters())}))}function initializeInteractions(){const t=document.querySelectorAll(".filter-btn"),e=document.getElementById("searchInput"),n=document.querySelector(".search-box");t.forEach(t=>{t.addEventListener("mouseenter",function(){this.classList.contains("active")||(this.style.transform="translateY(-2px)")}),t.addEventListener("mouseleave",function(){this.classList.contains("active")||(this.style.transform="translateY(0)")})}),e&&n&&(e.addEventListener("focus",function(){n.style.transform="translateY(-2px)"}),e.addEventListener("blur",function(){n.style.transform="translateY(0)"}));const a=document.querySelector(".back-button");a&&(a.addEventListener("mouseenter",function(){this.style.transform="translateY(-2px)"}),a.addEventListener("mouseleave",function(){this.style.transform="translateY(0)"}))}function createLoadingOverlay(){const t=document.createElement("div");return t.className="page-loading-overlay",t.id="pageLoadingOverlay",t.innerHTML='\n    <div class="loading-spinner-container">\n      <div class="modern-loading-spinner"></div>\n      <div class="loading-text">\n        Se încarcă<span class="loading-dots"></span>\n      </div>\n    </div>\n  ',document.body.appendChild(t),t}function showLoadingOverlay(){document.body.classList.add("loading"),document.body.classList.remove("loaded");let t=document.getElementById("pageLoadingOverlay");t||(t=createLoadingOverlay()),t.classList.remove("hidden")}function hideLoadingOverlay(){const t=document.getElementById("pageLoadingOverlay");t&&(t.classList.add("hidden"),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},500)),document.body.classList.remove("loading"),document.body.classList.add("loaded")}function navigateWithLoading(t){showLoadingOverlay(),setTimeout(()=>{window.location.href=t},100)}document.addEventListener("DOMContentLoaded",function(){initializeFiltering(),initializeSearch(),initializeInteractions(),loadLocations()}),window.addEventListener("beforeunload",function(){showLoadingOverlay()}),document.addEventListener("DOMContentLoaded",function(){try{showLoadingOverlay(),initializeFiltering(),initializeSearch(),initializeInteractions(),loadLocations(),setTimeout(()=>{hideLoadingOverlay()},800),setTimeout(()=>{document.querySelectorAll('a[href*=".html"], .btn[href*=".html"], .back-button').forEach(t=>{t.addEventListener("click",function(t){const e=this.getAttribute("href");!e||!e.includes(".html")||e.startsWith("http")||e.startsWith("mailto")||e.startsWith("tel")||(t.preventDefault(),navigateWithLoading(e))})})},100)}catch(t){console.error("Rezervari page initialization error:",t),hideLoadingOverlay()}});