const isLocalDev="undefined"!=typeof window&&("localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname),API_BASE_URL=isLocalDev?"/api":"https://api.acoomh.ro";let allEvents=[],filteredEvents=[],currentFilter="all",currentSearchTerm="";const DOM={loadingState:null,errorState:null,eventsContainer:null,emptyResults:null,eventsGrid:null,errorMessage:null,searchInput:null};function initializeDOM(){DOM.loadingState=document.getElementById("loadingState"),DOM.errorState=document.getElementById("errorState"),DOM.eventsContainer=document.getElementById("eventsContainer"),DOM.emptyResults=document.getElementById("emptyResults"),DOM.eventsGrid=document.getElementById("eventsGrid"),DOM.errorMessage=document.getElementById("errorMessage"),DOM.searchInput=document.getElementById("searchInput")}async function loadEvents(){showLoadingState();try{const e=await fetch(`${API_BASE_URL}/events`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json(),n=t.data||t||[];if(!Array.isArray(n))throw new Error("Răspunsul API-ului nu conține un array valid de evenimente");allEvents=n,filteredEvents=n,displayEvents(filteredEvents),hideLoadingState(),hideLoadingOverlay(),console.log("✅ Successfully loaded events from API:",n.length)}catch(e){console.error("Error loading events from API:",e),showErrorState(`Nu am putut încărca evenimentele. ${e.message}`),hideLoadingOverlay()}}function showLoadingState(){DOM.loadingState.style.display="block",DOM.errorState.style.display="none",DOM.eventsContainer.style.display="none",DOM.emptyResults.style.display="none"}function showErrorState(e){DOM.loadingState.style.display="none",DOM.errorState.style.display="block",DOM.eventsContainer.style.display="none",DOM.emptyResults.style.display="none",DOM.errorMessage.textContent=e||"Nu am putut încărca evenimentele disponibile."}function hideLoadingState(){DOM.loadingState.style.display="none",DOM.errorState.style.display="none"}function displayEvents(e){if(!e||0===e.length)return DOM.eventsContainer.style.display="none",void(DOM.emptyResults.style.display="block");DOM.eventsContainer.style.display="block",DOM.emptyResults.style.display="none";const t=document.createDocumentFragment();e.forEach(e=>{const n=createEventCard(e);t.appendChild(n)}),DOM.eventsGrid.innerHTML="",DOM.eventsGrid.appendChild(t)}function getOptimizedEventImageUrl(e){const t={concert:"https://images.unsplash.com/photo-1501386761578-eac5c94b800a?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80",festival:"https://images.unsplash.com/photo-1459749411175-04bf5292ceea?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80",teatru:"https://images.unsplash.com/photo-1507924538820-ede94a04019d?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80",conferinta:"https://images.unsplash.com/photo-1505373877841-8d25f7d46678?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80",sport:"https://images.unsplash.com/photo-1540747913346-19e32dc3e97e?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80"},n=t[(e.Category||e.category||"concert").toLowerCase()]||t.concert;if(e.photoUrl)return e.photoUrl;if(!e.Photo&&!e.photo)return n;try{const t=e.Photo||e.photo;return"string"==typeof t?"use_photo_url"===t?e.photoUrl||n:t.startsWith("data:image/")||t.startsWith("http")?t:`data:image/jpeg;base64,${t}`:n}catch(t){return console.warn("Error processing image for event:",e.id),n}}function createEventCard(e){const t=document.createElement("div");t.className="event-card",t.setAttribute("data-event-id",e.id);let n=[];e.tags&&("string"==typeof e.tags?n=e.tags.split(",").map(e=>e.trim()).filter(Boolean):Array.isArray(e.tags)&&(n=e.tags.map(e=>String(e).trim()).filter(Boolean)));const a=getOptimizedEventImageUrl(e),o=e.Name||e.name||"Eveniment",i=e.Location||e.location||"Locație necunoscută",s=e.Category||e.category||"Eveniment",r=e.Price||e.price||"Preț la cerere";let l="Data se anunță",c="";if(e.Date||e.date){l=new Date(e.Date||e.date).toLocaleDateString("ro-RO",{day:"numeric",month:"short"})}return(e.Time||e.time)&&(c=e.Time||e.time),t.innerHTML=`\n    <div class="event-image">\n      <img src="${a}" alt="${o}" loading="lazy" onerror="this.src='${getOptimizedEventImageUrl({})}'" />\n      <div class="event-category">${getCategoryIcon(s)} ${s}</div>\n      <div class="event-date-badge">${l}</div>\n    </div>\n    <div class="event-content">\n      <h3 class="event-name">${o}</h3>\n      <p class="event-location">\n        <i class="fas fa-map-marker-alt"></i>\n        ${i}\n      </p>\n      ${c?`\n        <p class="event-time">\n          <i class="fas fa-clock"></i>\n          ${c}\n        </p>\n      `:""}\n      <p class="event-price">\n        <i class="fas fa-ticket-alt"></i>\n        ${r}\n      </p>\n      ${n.length>0?`\n        <div class="event-tags">\n          ${n.slice(0,2).map(e=>`<span class="event-tag">${e}</span>`).join("")}\n          ${n.length>2?`<span class="event-tag">+${n.length-2}</span>`:""}\n        </div>\n      `:""}\n      <div class="event-actions">\n        <button class="btn-view-details" data-event-id="${e.id}">\n          <i class="fas fa-eye"></i>\n          Vezi detalii\n        </button>\n        <button class="btn-reserve" data-event-id="${e.id}">\n          <i class="fas fa-ticket-alt"></i>\n          Rezervă bilete\n        </button>\n      </div>\n    </div>\n  `,t.addEventListener("click",function(t){console.log("Event card clicked!",{eventId:e.id,target:t.target}),handleCardClick(t,e.id)}),t}function handleCardClick(e,t){const n=t||e.target.closest("[data-event-id]")?.dataset.eventId;console.log("handleCardClick called",{finalEventId:n,target:e.target.tagName}),n?e.target.closest(".btn-view-details")?(console.log("Clicked Vezi detalii button"),e.preventDefault(),e.stopPropagation(),navigateToEvent(n)):e.target.closest(".btn-reserve")?(console.log("Clicked Rezervă bilete button"),e.preventDefault(),e.stopPropagation(),navigateToEventReservation(n)):e.target.closest("button")||(console.log("Clicked somewhere else on card - navigating to event"),e.preventDefault(),e.stopPropagation(),navigateToEvent(n)):console.warn("No eventId found!")}function navigateToEvent(e){showLoadingOverlayImmediately(),window.location.href=`event.html?id=${e}`}function navigateToEventReservation(e){showLoadingOverlayImmediately(),window.location.href=`event.html?id=${e}#reservation`}function getCategoryIcon(e){return`<i class="${{concert:"fas fa-music",festival:"fas fa-star",teatru:"fas fa-theater-masks",conferinta:"fas fa-microphone",sport:"fas fa-trophy",club:"fas fa-cocktail",party:"fas fa-glass-cheers"}[e.toLowerCase()]||"fas fa-calendar-alt"}"></i>`}function initializeFiltering(){const e=document.querySelectorAll(".filter-btn");e.forEach(t=>{t.addEventListener("click",function(){e.forEach(e=>{e.classList.remove("active"),e.hasAttribute("role")&&e.setAttribute("aria-selected","false")}),this.classList.add("active"),this.hasAttribute("role")&&this.setAttribute("aria-selected","true"),currentFilter=this.dataset.type,applyFilters()})}),e.forEach(e=>{const t=e.classList.contains("active");e.hasAttribute("role")&&e.setAttribute("aria-selected",t?"true":"false")})}function applyFilters(){let e=[...allEvents];if("all"!==currentFilter){const t={concert:["concert","concerte","muzică"],festival:["festival","festivaluri"],teatru:["teatru","spectacol","piesa"],sport:["sport","meci","competiție"],conferinta:["conferință","prezentare","workshop"]}[currentFilter]||[currentFilter];e=e.filter(e=>{const n=(e.Category||e.category||"").toLowerCase();return t.some(e=>n.includes(e.toLowerCase()))})}currentSearchTerm&&(e=e.filter(e=>{const t=currentSearchTerm.toLowerCase(),n=(e.Name||e.name||"").toLowerCase(),a=(e.Location||e.location||"").toLowerCase(),o=(e.Category||e.category||"").toLowerCase(),i=n.includes(t)||a.includes(t)||o.includes(t);let s=!1;return e.tags&&("string"==typeof e.tags?s=e.tags.toLowerCase().includes(t):Array.isArray(e.tags)&&(s=e.tags.some(e=>String(e).toLowerCase().includes(t)))),i||s})),filteredEvents=e,displayEvents(filteredEvents)}function initializeSearch(){const e=document.getElementById("searchInput");e&&(e.addEventListener("input",function(){currentSearchTerm=this.value.trim(),applyFilters()}),e.addEventListener("keypress",function(e){"Enter"===e.key&&(e.preventDefault(),applyFilters())}))}function initializeInteractions(){const e=document.querySelectorAll(".filter-btn"),t=document.getElementById("searchInput"),n=document.querySelector(".search-box");e.forEach(e=>{e.addEventListener("mouseenter",function(){this.classList.contains("active")||(this.style.transform="translateY(-2px)")}),e.addEventListener("mouseleave",function(){this.classList.contains("active")||(this.style.transform="translateY(0)")})}),t&&n&&(t.addEventListener("focus",function(){n.style.transform="translateY(-2px)"}),t.addEventListener("blur",function(){n.style.transform="translateY(0)"}));const a=document.querySelector(".back-button");a&&(a.addEventListener("mouseenter",function(){this.style.transform="translateY(-2px)"}),a.addEventListener("mouseleave",function(){this.style.transform="translateY(0)"}))}function setupNavigationHandlers(){document.querySelectorAll('a[href*=".html"], .btn[href*=".html"], .back-button').forEach(e=>{e.addEventListener("click",function(e){const t=this.getAttribute("href");!t||!t.includes(".html")||t.startsWith("http")||t.startsWith("mailto")||t.startsWith("tel")||(e.preventDefault(),navigateWithLoading(t))})})}function createLoadingOverlay(){const e=document.createElement("div");return e.className="page-loading-overlay",e.id="pageLoadingOverlay",e.innerHTML='\n    <div class="loading-spinner-container">\n      <div class="modern-loading-spinner"></div>\n      <div class="loading-text">\n        Se încarcă<span class="loading-dots"></span>\n      </div>\n    </div>\n  ',document.body.appendChild(e),e}function showLoadingOverlay(){document.body.classList.add("loading"),document.body.classList.remove("loaded");let e=document.getElementById("pageLoadingOverlay");e||(e=createLoadingOverlay()),e.classList.remove("hidden")}function hideLoadingOverlay(){const e=document.getElementById("pageLoadingOverlay");e&&(e.classList.add("hidden"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},500)),document.body.classList.remove("loading"),document.body.classList.add("loaded"),document.body.style.pointerEvents="auto"}function navigateWithLoading(e){clearTimeout(window.loadingTimeout),showLoadingOverlay(),window.location.href=e}function showLoadingOverlayImmediately(){document.body.classList.add("loading"),document.body.classList.remove("loaded");let e=document.getElementById("pageLoadingOverlay");e||(e=createLoadingOverlay()),e.classList.remove("hidden")}document.addEventListener("DOMContentLoaded",function(){try{initializeDOM(),document.body.style.pointerEvents="auto";const e=document.getElementById("immediateLoadingOverlay");e&&(e.id="pageLoadingOverlay"),initializeFiltering(),initializeSearch(),initializeInteractions(),loadEvents(),requestAnimationFrame(setupNavigationHandlers)}catch(e){console.error("Events page initialization error:",e),hideLoadingOverlay()}}),document.addEventListener("visibilitychange",function(){document.hidden||setTimeout(()=>{const e=document.getElementById("pageLoadingOverlay");e&&!e.classList.contains("hidden")&&hideLoadingOverlay()},100)}),window.addEventListener("pageshow",function(e){e.persisted&&hideLoadingOverlay()}),window.addEventListener("beforeunload",function(){showLoadingOverlay()}),console.log("Events page JavaScript initialized successfully");