const API_BASE_URL="https://api.acoomh.ro";let currentLocation=null;function createLoadingOverlay(){const e=document.createElement("div");return e.className="page-loading-overlay",e.id="pageLoadingOverlay",e.innerHTML='\n    <div class="loading-spinner-container">\n      <div class="modern-loading-spinner"></div>\n      <div class="loading-text">\n        Se încarcă<span class="loading-dots"></span>\n      </div>\n    </div>\n  ',document.body.appendChild(e),e}function showLoadingOverlay(){document.body.classList.add("loading"),document.body.classList.remove("loaded");let e=document.getElementById("pageLoadingOverlay");e||(e=createLoadingOverlay()),e.classList.remove("hidden")}function hideLoadingOverlay(){const e=document.getElementById("pageLoadingOverlay");e&&(e.classList.add("hidden"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},500)),document.body.classList.remove("loading"),document.body.classList.add("loaded")}function navigateWithLoading(e){clearTimeout(window.loadingTimeout),showLoadingOverlay(),window.location.href=e}async function loadLocationDetails(e){try{const t=await fetch(`${API_BASE_URL}/locations/${e}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();currentLocation=a,populateLocationDetails(a),await loadLocationHours(e),console.log("✅ Successfully loaded location details:",a),setTimeout(()=>{hideLoadingOverlay(),setTimeout(()=>{document.body.classList.add("loaded")},100)},500)}catch(e){console.error("Error loading location details:",e),showError(`Nu am putut încărca datele restaurantului. ${e.message}`),hideLoadingOverlay()}}async function loadLocationHours(e){try{const t=await fetch(`${API_BASE_URL}/locations/${e}/hours`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(t.ok){const e=await t.json();currentLocation.hours=e,console.log("✅ Successfully loaded location hours:",e)}else console.log("No hours data available for this location"),currentLocation.hours=[]}catch(e){console.log("Could not load location hours:",e),currentLocation.hours=[]}}async function createReservation(e){try{const t=new FormData;t.append("customerName",e.customerName),t.append("customerEmail",e.customerEmail),t.append("customerPhone",e.customerPhone),t.append("reservationDate",e.reservationDate),t.append("reservationTime",e.reservationTime),t.append("numberOfPeople",e.numberOfPeople.toString()),t.append("locationId",e.locationId.toString()),t.append("specialRequests",e.specialRequests||""),e.userId&&t.append("userId",e.userId.toString());const a=await fetch(`${API_BASE_URL}/reservation`,{method:"POST",body:t});if(!a.ok){const e=await a.text();let t="A apărut o eroare la crearea rezervării.";try{t=JSON.parse(e).message||t}catch{e.length<200&&(t=e)}throw new Error(t)}const n=await a.json();return console.log("✅ Successfully created reservation:",n),n}catch(e){throw console.error("Error creating reservation:",e),e}}function getLocationId(){return new URLSearchParams(window.location.search).get("id")}function showLoadingState(){document.body.classList.add("loading")}function hideLoadingState(){document.body.classList.remove("loading")}function showError(e){showPopup("Eroare",e,"fas fa-exclamation-triangle")}function populateLocationDetails(e){document.getElementById("restaurantName").textContent=e.Name||e.name||"Restaurant",document.getElementById("restaurantAddress").textContent=e.Address||e.address||"Adresă necunoscută",document.getElementById("restaurantCuisine").textContent=e.Category||e.category||"Restaurant";const t=e.Description||e.description||`Descoperă ${e.Name||e.name||"acest loc"}, un loc minunat cu o atmosferă unică și o experiență de neuitat. Situat în ${e.Address||e.address||"oraș"}, oferim servicii de calitate și o experiență plăcută pentru toți vizitatorii.`;document.getElementById("restaurantDescription").textContent=t;const a=document.getElementById("restaurantImage"),n=e.Photo||e.photo;if(n)try{let t;if("string"==typeof n)t=n.startsWith("data:")?n:`data:image/jpeg;base64,${n}`;else if(Array.isArray(n)&&n.length>0){t=`data:image/jpeg;base64,${btoa(String.fromCharCode.apply(null,n))}`}t?(a.src=t,a.onerror=()=>setDefaultImage(a,e.Category||e.category)):setDefaultImage(a,e.Category||e.category)}catch(t){console.error("Error processing image:",t),setDefaultImage(a,e.Category||e.category)}else setDefaultImage(a,e.Category||e.category);a.alt=e.Name||e.name||"Restaurant";const o=document.getElementById("restaurantTags");o.innerHTML="";const r=e.category||e.Category||"Location";console.log(r+"test");const s=document.createElement("span");s.className="restaurant-tag primary";const i=getCategoryIcon(r),c=document.createElement("i");c.className=i,s.appendChild(c),s.appendChild(document.createTextNode(` ${r}`)),o.appendChild(s);const l=e.tags;if(l&&Array.isArray(l)&&l.length>0){const e=l.filter(e=>e&&e.trim().length>0);e.slice(0,4).forEach(e=>{const t=document.createElement("span");t.className="restaurant-tag",t.textContent=e,o.appendChild(t)}),console.log("✅ Tags processed from API:",e)}else console.log("ℹ️ No tags data available for this location");if(populateSchedule(e.hours),populateFeatures(e),e.Company&&e.Company.phone){const t=document.getElementById("restaurantPhone");t&&(t.textContent=e.Company.phone,t.href=`tel:${e.Company.phone.replace(/\s/g,"")}`)}else if(e.phone){const t=document.getElementById("restaurantPhone");t&&(t.textContent=e.phone,t.href=`tel:${e.phone.replace(/\s/g,"")}`)}else{const e=document.getElementById("restaurantPhone");if(e){const t=e.closest(".info-item");t&&(t.style.display="none")}}document.title=`${e.Name||e.name||"Restaurant"} - AcoomH`,console.log("✅ Location details populated successfully:",e)}function populateSchedule(e){const t=document.getElementById("restaurantSchedule");if(!t)return void console.warn("Schedule container not found");t.innerHTML="";const a=(new Date).getDay(),n=["Duminică","Luni","Marți","Miercuri","Joi","Vineri","Sâmbătă"],o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];if(console.log("Processing schedule with hours:",e),e&&Array.isArray(e)&&e.length>0)n.forEach((n,r)=>{const s=o[r],i=e.find(e=>e.DayOfWeek===n||e.DayOfWeek===s||e.dayOfWeek===n||e.dayOfWeek===s),c=document.createElement("div");c.className="schedule-item";const l=r===a;let u="Nedisponibil",d=!0;if(i)if(i.IsClosed||i.isClosed)u="Închis",d=!0;else if(i.OpenTime||i.openTime){u=`${i.OpenTime||i.openTime} - ${i.CloseTime||i.closeTime}`,d=!1}c.innerHTML=`\n        <span class="schedule-day">${n}</span>\n        <span class="schedule-hours ${d?"closed":""} ${l?"current-day":""}">${u}</span>\n      `,t.appendChild(c)}),console.log("✅ Schedule populated from API data");else{const e={Luni:"10:00 - 22:00","Marți":"10:00 - 22:00",Miercuri:"10:00 - 22:00",Joi:"10:00 - 22:00",Vineri:"10:00 - 23:00","Sâmbătă":"10:00 - 23:00","Duminică":"12:00 - 21:00"};Object.entries(e).forEach(([e,a],n)=>{const o=document.createElement("div");o.className="schedule-item",o.innerHTML=`\n        <span class="schedule-day">${e}</span>\n        <span class="schedule-hours">${a}</span>\n      `,t.appendChild(o)}),console.log("✅ Default schedule populated")}}function populateFeatures(e){const t=document.getElementById("restaurantFeatures");t.innerHTML="";[{icon:"fas fa-credit-card",name:"Plată cu cardul"},{icon:"fas fa-calendar-check",name:"Rezervări online"},...{restaurant:[{icon:"fas fa-utensils",name:"Meniu variat"},{icon:"fas fa-users",name:"Pentru grupuri"}],cafe:[{icon:"fas fa-wifi",name:"WiFi gratuit"},{icon:"fas fa-coffee",name:"Cafea proaspătă"}],cafenea:[{icon:"fas fa-wifi",name:"WiFi gratuit"},{icon:"fas fa-coffee",name:"Cafea proaspătă"}],pub:[{icon:"fas fa-beer",name:"Bere la halba"},{icon:"fas fa-tv",name:"Transmisiuni live"}],club:[{icon:"fas fa-music",name:"Muzică live"},{icon:"fas fa-cocktail",name:"Cocktailuri"}]}[e.category&&"string"==typeof e.category?e.category.toLowerCase():"restaurant"]||[]].forEach(e=>{const a=document.createElement("div");a.className="feature-item",a.innerHTML=`\n      <i class="${e.icon}"></i>\n      <span>${e.name}</span>\n    `,t.appendChild(a)})}function getCategoryIcon(e){if(!e||"string"!=typeof e)return"fas fa-store";return{restaurant:"fas fa-utensils",cafe:"fas fa-coffee",cafenea:"fas fa-coffee",pub:"fas fa-beer",club:"fas fa-music",bar:"fas fa-cocktail"}[e.toLowerCase()]||"fas fa-store"}function setDefaultImage(e,t){const a={restaurant:"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",cafe:"https://images.unsplash.com/photo-1501339847302-ac426a4a7cbb?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",cafenea:"https://images.unsplash.com/photo-1501339847302-ac426a4a7cbb?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",pub:"https://images.unsplash.com/photo-1572116469696-31de0f17cc34?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",club:"https://images.unsplash.com/photo-1571266028243-d220c9f3e821?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",bar:"https://images.unsplash.com/photo-1514362545857-3bc16c4c7d1b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"},n=t&&"string"==typeof t?t.toLowerCase():"restaurant";e.src=a[n]||a.restaurant}function arrayBufferToBase64(e){let t="";const a=new Uint8Array(e),n=a.byteLength;for(let e=0;e<n;e++)t+=String.fromCharCode(a[e]);return window.btoa(t)}function initializeReservationForm(){const e=document.getElementById("reservationDate"),t=new Date,a=new Date;a.setDate(t.getDate()+30),e.min=t.toISOString().split("T")[0],e.max=a.toISOString().split("T")[0];const n=new Date;n.setDate(t.getDate()+1),e.value=n.toISOString().split("T")[0]}function validateReservationForm(){const e=document.getElementById("fullName").value.trim(),t=document.getElementById("phoneNumber").value.trim(),a=document.getElementById("reservationDate").value,n=document.getElementById("reservationTime").value,o=document.getElementById("guestCount").value,r=[];if(e?e.length<2&&r.push("Numele trebuie să aibă cel puțin 2 caractere"):r.push("Introdu numele tău complet"),t?/^(\+4|4|0)?\d{9}$/.test(t.replace(/\s/g,""))||r.push("Numărul de telefon nu este valid (ex: 0721234567)"):r.push("Introdu numărul de telefon"),a){const e=new Date(a),t=new Date;t.setHours(0,0,0,0),e<t&&r.push("Data rezervării nu poate fi în trecut")}else r.push("Selectează o dată pentru rezervare");return n||r.push("Selectează ora pentru rezervare"),o||r.push("Selectează numărul de persoane"),{isValid:0===r.length,errors:r}}function showPopup(e,t,a="fas fa-info-circle",n=!1){document.querySelectorAll(".popup-overlay").forEach(e=>e.remove());const o=document.createElement("div");o.className="popup-overlay";const r=document.createElement("div");function closePopup(){o.style.opacity="0",r.style.transform="scale(0.8) translateY(20px)",setTimeout(()=>{document.body.contains(o)&&document.body.removeChild(o)},300)}r.className="popup-content",r.innerHTML=`\n    <div style="margin-bottom: 25px;">\n      <i class="${a}" style="font-size: 3rem; color: ${n?"var(--success-color)":"var(--primary-color)"}; margin-bottom: 20px; display: block;"></i>\n      <h3>${e}</h3>\n      <p>${t}</p>\n    </div>\n    <button class="popup-close-btn">\n      <i class="fas fa-check" style="margin-right: 8px;"></i>\n      Înțeles!\n    </button>\n  `,r.querySelector(".popup-close-btn").addEventListener("click",closePopup),o.addEventListener("click",e=>{e.target===o&&closePopup()});const escapeHandler=e=>{"Escape"===e.key&&(closePopup(),document.removeEventListener("keydown",escapeHandler))};document.addEventListener("keydown",escapeHandler),o.appendChild(r),document.body.appendChild(o),setTimeout(()=>{o.style.opacity="1",r.style.transform="scale(1) translateY(0)"},10)}function setupFormValidation(){document.querySelectorAll(".form-input").forEach(e=>{e.addEventListener("blur",function(){validateInput(this)}),e.addEventListener("input",function(){this.classList.contains("error")&&validateInput(this)})})}function validateInput(e){const t=e.value;let a=!0,n="";if(e.hasAttribute("required")&&!t)a=!1,n="Acest câmp este obligatoriu";else if("date"===e.type&&t){const e=new Date(t),o=new Date;o.setHours(0,0,0,0),e<o&&(a=!1,n="Data nu poate fi în trecut")}const o=e.parentNode.querySelector(".error-message");if(o&&o.remove(),e.classList.remove("success","error"),a)t&&e.classList.add("success");else{e.classList.add("error");const t=document.createElement("div");t.className="error-message",t.textContent=n,e.parentNode.appendChild(t)}return a}function getCurrentRestaurant(){if(currentLocation){let e="N/A";return currentLocation.Company&&currentLocation.Company.phone?e=currentLocation.Company.phone:currentLocation.phone&&(e=currentLocation.phone),{name:currentLocation.name||currentLocation.Name||"Restaurant",address:currentLocation.address||currentLocation.Address||"",phone:e,cuisine:currentLocation.category||currentLocation.Category||"Restaurant"}}return{name:"Restaurant",address:"",phone:"N/A",cuisine:"Restaurant"}}function initializeAnimations(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=document.querySelector(this.getAttribute("href"));t&&t.scrollIntoView({behavior:"smooth",block:"start"})})});const e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("animate-in")})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".restaurant-section, .info-section, .reservation-section").forEach(t=>e.observe(t))}function initializeNavbar(){const e=document.querySelector(".navbar");if(e){let t=window.scrollY;window.addEventListener("scroll",()=>{const a=window.scrollY;a>100?e.classList.add("scrolled"):e.classList.remove("scrolled"),a>t&&a>200?e.classList.add("hidden"):e.classList.remove("hidden"),t=a})}const t=document.querySelector(".mobile-menu-toggle"),a=document.querySelector(".mobile-menu");t&&a&&t.addEventListener("click",()=>{a.classList.toggle("active"),t.classList.toggle("active")})}function initializeAll(){initializeReservationForm(),setupFormValidation(),initializeAnimations(),initializeNavbar()}document.addEventListener("DOMContentLoaded",function(){try{const e=document.getElementById("immediateLoadingOverlay");e&&(e.id="pageLoadingOverlay");const t=getLocationId();if(!t)return showError("ID-ul locației nu a fost găsit în URL."),void hideLoadingOverlay();loadLocationDetails(t),initializeAll(),"#reservation"===window.location.hash&&setTimeout(()=>{const e=document.querySelector(".reservation-section");e&&e.scrollIntoView({behavior:"smooth"})},1e3),setTimeout(()=>{document.querySelectorAll('a[href*=".html"], .btn[href*=".html"], .back-button, .btn-back').forEach(e=>{e.addEventListener("click",function(e){const t=this.getAttribute("href");!t||!t.includes(".html")||t.startsWith("http")||t.startsWith("mailto")||t.startsWith("tel")||(e.preventDefault(),navigateWithLoading(t))})})},100)}catch(e){console.error("Restaurant page initialization error:",e),showError("A apărut o problemă la încărcarea paginii."),hideLoadingOverlay()}}),document.addEventListener("visibilitychange",function(){document.hidden||setTimeout(()=>{const e=document.getElementById("pageLoadingOverlay");e&&!e.classList.contains("hidden")&&hideLoadingOverlay()},100)}),window.addEventListener("pageshow",function(e){e.persisted&&hideLoadingOverlay()}),window.addEventListener("beforeunload",function(){showLoadingOverlay()}),window.makeReservation=async function(){const e=validateReservationForm();if(!e.isValid)return void showPopup("Formular incomplet",e.errors.join("<br>"),"fas fa-exclamation-triangle");if(!currentLocation)return void showPopup("Eroare","Datele locației nu sunt disponibile. Te rugăm să reîmprospătezi pagina.","fas fa-exclamation-triangle");const t=document.getElementById("fullName").value.trim(),a=document.getElementById("phoneNumber").value.trim(),n=document.getElementById("reservationDate").value,o=document.getElementById("reservationTime").value,r=document.getElementById("guestCount").value,s={customerName:t,customerEmail:`${t.replace(/\s+/g,"").toLowerCase()}@temp.acoomh.ro`,customerPhone:a,reservationDate:n,reservationTime:o+":00",numberOfPeople:parseInt(r),locationId:parseInt(currentLocation.id),specialRequests:"",status:"Pending"},i=document.querySelector(".btn-rezerva"),c=i.innerHTML;i.disabled=!0,i.innerHTML='<div class="loading"></div> Se procesează...';try{await createReservation(s);i.disabled=!1,i.innerHTML=c;const e=new Date(n).toLocaleDateString("ro-RO",{weekday:"long",year:"numeric",month:"long",day:"numeric"});showPopup("Rezervare confirmată!",`Mulțumim, <strong>${t}</strong>!<br><br>Rezervarea ta la <strong>${currentLocation.name}</strong> pentru <strong>${e}</strong> la ora <strong>${o}</strong> pentru <strong>${r} ${"1"===r?"persoană":"persoane"}</strong> a fost trimisă!<br><br>Vei fi contactat în curând pentru confirmare.`,"fas fa-check-circle",!0),document.getElementById("fullName").value="",document.getElementById("phoneNumber").value="",document.getElementById("reservationDate").value="",document.getElementById("reservationTime").value="",document.getElementById("guestCount").value=""}catch(e){i.disabled=!1,i.innerHTML=c,showPopup("Eroare la rezervare",e.message||"Nu am putut procesa rezervarea. Te rugăm să încerci din nou.","fas fa-exclamation-triangle")}},window.callRestaurant=function(){const e=getCurrentRestaurant();e.phone&&(window.location.href=`tel:${e.phone}`)},window.openMaps=function(){const e=getCurrentRestaurant();if(e.address){const t=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e.address)}`;window.open(t,"_blank")}},window.shareRestaurant=function(){const e=getCurrentRestaurant(),t={title:e.name,text:`Descoperă ${e.name} pe AcoomH!`,url:window.location.href};function fallbackShare(){navigator.clipboard.writeText(window.location.href).then(()=>{showPopup("Link copiat!","Link-ul către restaurant a fost copiat în clipboard.","fas fa-copy",!0)}).catch(()=>{showPopup("Partajare",`Copiază acest link pentru a partaja restaurantul:<br><br><code style="background: var(--bg-dark); padding: 8px; border-radius: 6px; font-size: 0.8rem; word-break: break-all;">${window.location.href}</code>`,"fas fa-share-alt")})}navigator.share?navigator.share(t).catch(e=>{console.log("Error sharing:",e),fallbackShare()}):fallbackShare()},window.viewMenu=async function(){if(!currentLocation)return void showPopup("Eroare","Datele locației nu sunt disponibile. Te rugăm să reîmprospătezi pagina.","fas fa-exclamation-triangle");const e=getCurrentRestaurant();showPopup("Se încarcă meniul...",'<div class="loading" style="margin: 20px auto;"></div>',"fas fa-utensils");try{const t=await fetch(`${API_BASE_URL}/locations/${currentLocation.id}/menu`,{method:"GET",headers:{Accept:"application/pdf,*/*"}});if(document.querySelectorAll(".popup-overlay").forEach(e=>e.remove()),t.ok){const a=await t.blob();if(!(a.size>0))throw new Error("Fișierul meniu este gol");{const t=URL.createObjectURL(a),n=window.open(t,"_blank");if(n)n.document.title=`Meniu - ${e.name}`,showPopup("Meniu deschis!",`Meniul pentru <strong>${e.name}</strong> s-a deschis într-o fereastră nouă.`,"fas fa-check-circle",!0);else{const a=document.createElement("a");a.href=t,a.download=`Meniu-${e.name.replace(/\s+/g,"-")}.pdf`,a.click(),showPopup("Meniu descărcat!",`Meniul pentru <strong>${e.name}</strong> a fost descărcat pe dispozitivul tău.`,"fas fa-download",!0)}setTimeout(()=>{URL.revokeObjectURL(t)},6e4)}}else{if(404!==t.status)throw new Error(`Eroare server: ${t.status}`);{const t=getCurrentRestaurant().phone,a=t&&"N/A"!==t?`<strong><a href="tel:${t.replace(/\s/g,"")}" style="color: var(--primary-color);">📞 ${t}</a></strong>`:"restaurant direct";showPopup("Meniu indisponibil",`Meniul pentru <strong>${e.name}</strong> nu este disponibil momentan.<br><br>Te rugăm să contactezi ${a} pentru informații despre preparatele disponibile.`,"fas fa-info-circle")}}}catch(t){console.error("Error loading menu:",t);document.querySelectorAll(".popup-overlay").forEach(e=>e.remove());const a=getCurrentRestaurant().phone,n=a&&"N/A"!==a?`<strong><a href="tel:${a.replace(/\s/g,"")}" style="color: var(--primary-color);">📞 ${a}</a></strong>`:"restaurant direct";showPopup("Eroare la încărcarea meniului",`Nu am putut încărca meniul pentru <strong>${e.name}</strong>.<br><br>Te rugăm să încerci din nou mai târziu sau să contactezi ${n} pentru informații despre preparate.`,"fas fa-exclamation-triangle")}},window.goBack=function(){document.referrer&&document.referrer.includes(window.location.origin)?history.back():window.location.href="index.html"},initializeAll(),window.addEventListener("load",function(){document.body.classList.add("loaded")}),console.log("Restaurant page initialized successfully");const RestaurantUtils={formatPhoneNumber:function(e){return e.replace(/(\d{4})(\d{3})(\d{3})/,"$1 $2 $3")},isRestaurantOpen:function(e){const t=new Date,a=t.toLocaleDateString("ro-RO",{weekday:"long"}),n=a.charAt(0).toUpperCase()+a.slice(1),o=100*t.getHours()+t.getMinutes(),r=e[n];if(!r||r.toLowerCase().includes("închis"))return!1;const[s,i]=r.split(" - ").map(e=>{const[t,a]=e.split(":").map(Number);return 100*t+a});return o>=s&&o<=i},generateStarsHTML:function(e){const t=Math.floor(e),a=e%1!=0;let n="";for(let e=0;e<t;e++)n+='<i class="fas fa-star"></i>';a&&(n+='<i class="fas fa-star-half-alt"></i>');const o=5-Math.ceil(e);for(let e=0;e<o;e++)n+='<i class="far fa-star"></i>';return n}};