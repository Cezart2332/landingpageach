document.body.classList.add("loading");const immediateOverlay=document.createElement("div");immediateOverlay.className="page-loading-overlay",immediateOverlay.id="pageLoadingOverlay",immediateOverlay.innerHTML='\n  <div class="loading-spinner-container">\n    <div class="modern-loading-spinner"></div>\n    <div class="loading-text">\n      Se încarcă<span class="loading-dots"></span>\n    </div>\n  </div>\n',document.body.appendChild(immediateOverlay);const API_BASE_URL="https://api.acoomh.ro";let allMerchantRequests=[],filteredMerchantRequests=[],currentSearchTerm="",currentStatusFilter="all",currentBusinessTypeFilter="all",currentSortBy="newest",selectedMerchantRequest=null;async function loadMerchantRequests(){showLoadingState();try{const e=await fetch(`${API_BASE_URL}/companies`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status} - ${e.statusText}`);const t=await e.json();if(console.log("Raw API response:",t),!Array.isArray(t))throw console.error("Invalid API response format:",t),new Error("API returned invalid data format. Expected an array of companies.");if(0===t.length)return console.log("No companies found in API response"),allMerchantRequests=[],filteredMerchantRequests=[],updateStatistics(),displayMerchantRequests(filteredMerchantRequests),void hideLoadingState();allMerchantRequests=t.filter(e=>!!(e&&e.id&&e.name)||(console.warn("Skipping invalid company:",e),!1)).map(e=>{const t=e.address||"Adresă nedisponibilă",n=e.phone||"+40700000000",s=e.description||"Descriere nedisponibilă";return{id:e.id,businessName:e.name,businessType:mapCategoryToBusinessType(e.category),status:!1===e.isActive?"pending":"approved",ownerName:extractOwnerNameFromEmail(e.email),ownerEmail:e.email,ownerPhone:n,businessAddress:t,businessDescription:s,yearsInBusiness:Math.floor(10*Math.random())+1,numberOfEmployees:Math.floor(50*Math.random())+5,averageDailyCustomers:Math.floor(100*Math.random())+20,businessHours:getDefaultBusinessHours(),documents:{businessLicense:`license_${e.name.toLowerCase().replace(/\s+/g,"_")}.pdf`,taxRegistration:`tax_${e.cui||"unknown"}.pdf`},createdAt:new Date(Date.now()-30*Math.random()*24*60*60*1e3).toISOString(),updatedAt:(new Date).toISOString(),approvedAt:!1===e.isActive?null:(new Date).toISOString(),approvedBy:!1===e.isActive?null:"admin@acoomh.ro",cui:e.cui||"N/A",isActive:e.isActive}}),filteredMerchantRequests=allMerchantRequests,updateStatistics(),displayMerchantRequests(filteredMerchantRequests),hideLoadingState(),console.log(`✅ Successfully loaded ${allMerchantRequests.length} companies as merchant requests`)}catch(e){console.error("Error loading merchant requests:",e);let t="Nu s-au putut încărca datele companiilor.";e.message.includes("Failed to fetch")?t="Nu s-a putut conecta la server. Verificați conexiunea la internet.":e.message.includes("500")?t="Eroare de server. Încercați din nou mai târziu.":e.message.includes("404")?t="Endpoint-ul API nu a fost găsit.":e.message.includes("invalid data format")&&(t="Datele primite de la server sunt în format incorect."),showErrorState(t)}}function mapCategoryToBusinessType(e){if(!e)return"restaurant";return{restaurant:"restaurant",cafe:"cafe",pub:"pub",club:"club",bar:"bar",cafenea:"cafe",bistro:"restaurant",pizzerie:"restaurant"}[e.toLowerCase()]||"restaurant"}function extractOwnerNameFromEmail(e){if(!e)return"Nume nedisponibil";return e.split("@")[0].split(/[._-]/).map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ")}function getDefaultBusinessHours(){return{monday:"09:00-22:00",tuesday:"09:00-22:00",wednesday:"09:00-22:00",thursday:"09:00-22:00",friday:"09:00-23:00",saturday:"10:00-23:00",sunday:"10:00-21:00"}}function showLoadingState(){document.getElementById("loadingState").style.display="flex",document.getElementById("errorState").style.display="none",document.getElementById("requestsContainer").style.display="none",document.getElementById("emptyState").style.display="none"}function showErrorState(e){document.getElementById("loadingState").style.display="none",document.getElementById("errorState").style.display="flex",document.getElementById("requestsContainer").style.display="none",document.getElementById("emptyState").style.display="none",document.getElementById("errorMessage").textContent=e||"Nu am putut încărca cererile comercianților."}function hideLoadingState(){document.getElementById("loadingState").style.display="none",document.getElementById("errorState").style.display="none"}function displayMerchantRequests(e){const t=document.getElementById("requestsGrid"),n=document.getElementById("requestsContainer"),s=document.getElementById("emptyState");if(!e||0===e.length)return n.style.display="none",void(s.style.display="flex");n.style.display="block",s.style.display="none",t.innerHTML="",e.forEach(e=>{const n=createMerchantRequestCard(e);t.appendChild(n)})}function createMerchantRequestCard(e){const t=document.createElement("div");t.className="merchant-request-card",t.onclick=()=>openMerchantModal(e);const n=new Date(e.createdAt).toLocaleDateString("ro-RO",{day:"numeric",month:"short",year:"numeric"}),s=e.status,a=getBusinessTypeIcon(e.businessType);return t.innerHTML=`\n    <div class="request-header">\n      <div class="business-info">\n        <div class="business-name">${e.businessName}</div>\n        <div class="business-type">\n          ${a}\n          ${getBusinessTypeText(e.businessType)}\n        </div>\n      </div>\n      <div class="request-status ${s}">${getStatusText(e.status)}</div>\n    </div>\n    \n    <div class="request-details">\n      <div class="contact-info">\n        <div class="contact-item">\n          <i class="fas fa-user"></i>\n          <span>${e.ownerName}</span>\n        </div>\n        <div class="contact-item">\n          <i class="fas fa-envelope"></i>\n          <span>${e.ownerEmail}</span>\n        </div>\n        <div class="contact-item">\n          <i class="fas fa-phone"></i>\n          <span>${e.ownerPhone}</span>\n        </div>\n        <div class="contact-item">\n          <i class="fas fa-building"></i>\n          <span>CUI: ${e.cui||"N/A"}</span>\n        </div>\n      </div>\n    </div>\n    \n    <div class="request-meta">\n      <div class="request-id">#${e.id}</div>\n      <div class="request-date">${n}</div>\n    </div>\n  `,t}function getStatusText(e){return{pending:"În Așteptare",approved:"Aprobat",rejected:"Respins"}[e]||e}function getBusinessTypeText(e){return{restaurant:"Restaurant",cafe:"Cafenea",pub:"Pub",club:"Club",bar:"Bar"}[e]||e}function getBusinessTypeIcon(e){return{restaurant:'<i class="fas fa-utensils"></i>',cafe:'<i class="fas fa-coffee"></i>',pub:'<i class="fas fa-beer"></i>',club:'<i class="fas fa-music"></i>',bar:'<i class="fas fa-cocktail"></i>'}[e]||'<i class="fas fa-store"></i>'}function updateStatistics(){const e=allMerchantRequests.filter(e=>"pending"===e.status).length,t=allMerchantRequests.filter(e=>"approved"===e.status).length,n=allMerchantRequests.filter(e=>"rejected"===e.status).length,s=allMerchantRequests.length;document.getElementById("pendingRequestsCount").textContent=e,document.getElementById("approvedRequestsCount").textContent=t,document.getElementById("rejectedRequestsCount").textContent=n,document.getElementById("totalRequestsCount").textContent=s}function initializeFilters(){const e=document.getElementById("statusFilter"),t=document.getElementById("businessTypeFilter"),n=document.getElementById("sortBy");e.addEventListener("change",function(){currentStatusFilter=this.value,applyFilters()}),t.addEventListener("change",function(){currentBusinessTypeFilter=this.value,applyFilters()}),n.addEventListener("change",function(){currentSortBy=this.value,applyFilters()})}function initializeSearch(){const e=document.getElementById("searchInput");e&&e.addEventListener("input",function(){currentSearchTerm=this.value.trim().toLowerCase(),applyFilters()})}function applyFilters(){let e=[...allMerchantRequests];"all"!==currentStatusFilter&&(e=e.filter(e=>e.status===currentStatusFilter)),"all"!==currentBusinessTypeFilter&&(e=e.filter(e=>e.businessType===currentBusinessTypeFilter)),currentSearchTerm&&(e=e.filter(e=>e.businessName.toLowerCase().includes(currentSearchTerm)||e.ownerName.toLowerCase().includes(currentSearchTerm)||e.ownerEmail.toLowerCase().includes(currentSearchTerm)||e.ownerPhone.toLowerCase().includes(currentSearchTerm)||e.businessAddress.toLowerCase().includes(currentSearchTerm))),e.sort((e,t)=>{switch(currentSortBy){case"newest":return new Date(t.createdAt)-new Date(e.createdAt);case"oldest":return new Date(e.createdAt)-new Date(t.createdAt);case"name":return e.businessName.localeCompare(t.businessName);case"status":const n={pending:3,approved:2,rejected:1};return n[t.status]-n[e.status];default:return 0}}),filteredMerchantRequests=e,displayMerchantRequests(filteredMerchantRequests)}function openMerchantModal(e){selectedMerchantRequest=e;const t=document.getElementById("merchantModal"),n=document.getElementById("modalTitle"),s=document.getElementById("modalBody"),a=document.getElementById("actionButtons");n.textContent=`Companie #${e.id} - ${e.businessName}`;const i=new Date(e.createdAt).toLocaleString("ro-RO"),o=new Date(e.updatedAt).toLocaleString("ro-RO"),r=Object.entries(e.businessHours||{}).map(([e,t])=>`\n      <div class="hour-item">\n        <span class="hour-day">${{monday:"Luni",tuesday:"Marți",wednesday:"Miercuri",thursday:"Joi",friday:"Vineri",saturday:"Sâmbătă",sunday:"Duminică"}[e]}:</span>\n        <span class="hour-time">${t}</span>\n      </div>\n    `).join(""),c=e.documents?Object.entries(e.documents).map(([e,t])=>`\n      <a href="#" class="document-link" onclick="downloadDocument('${t}')">\n        <i class="fas fa-file-pdf"></i>\n        ${{businessLicense:"Licență Comercială",taxRegistration:"Înregistrare Fiscală",menuCard:"Meniu",soundLicense:"Licență Sonorizare"}[e]||e}\n      </a>\n    `).join(""):"Nu sunt documente încărcate";s.innerHTML=`\n    <div class="info-grid">\n      <div class="info-section">\n        <h4><i class="fas fa-store"></i> Informații Business</h4>\n        <p><strong>Nume:</strong> ${e.businessName}</p>\n        <p><strong>Tip:</strong> ${getBusinessTypeText(e.businessType)}</p>\n        <p><strong>Email:</strong> ${e.ownerEmail}</p>\n        <p><strong>CUI:</strong> ${e.cui||"N/A"}</p>\n        <p><strong>Status:</strong> <span class="request-status ${e.status}">${getStatusText(e.status)}</span></p>\n      </div>\n      \n      <div class="info-section">\n        <h4><i class="fas fa-user"></i> Informații Contact</h4>\n        <p><strong>Nume contact:</strong> ${e.ownerName}</p>\n        <p><strong>Email:</strong> ${e.ownerEmail}</p>\n        <p><strong>Telefon:</strong> ${e.ownerPhone}</p>\n      </div>\n    </div>\n    \n    <div class="info-section">\n      <h4><i class="fas fa-align-left"></i> Descriere Business</h4>\n      <p style="line-height: 1.6; color: var(--text-secondary);">${e.businessDescription}</p>\n    </div>\n    \n    <div class="info-section">\n      <h4><i class="fas fa-clock"></i> Program de Lucru (implicit)</h4>\n      <div class="hours-grid">\n        ${r}\n      </div>\n    </div>\n    \n    <div class="info-section">\n      <h4><i class="fas fa-file"></i> Documente</h4>\n      <div style="display: flex; flex-wrap: wrap; gap: 10px;">\n        ${c}\n      </div>\n    </div>\n    \n    <div class="info-grid">\n      <div class="info-section">\n        <h4><i class="fas fa-calendar"></i> Înregistrat la</h4>\n        <p>${i}</p>\n      </div>\n      \n      <div class="info-section">\n        <h4><i class="fas fa-edit"></i> Ultima actualizare</h4>\n        <p>${o}</p>\n      </div>\n    </div>\n    \n    ${"approved"===e.status?`\n      <div class="info-section" style="background: rgba(16, 185, 129, 0.1); border-color: var(--success-color);">\n        <h4 style="color: var(--success-color);"><i class="fas fa-check-circle"></i> Companie Activă</h4>\n        <p><strong>Status:</strong> Compania este activă în sistem</p>\n        <p><strong>Înregistrată de:</strong> ${e.approvedBy}</p>\n      </div>\n    `:""}\n  `,"pending"===e.status?a.style.display="flex":a.style.display="none",t.style.display="flex",setTimeout(()=>t.classList.add("show"),10)}function closeMerchantModal(){const e=document.getElementById("merchantModal");e.classList.remove("show"),setTimeout(()=>{e.style.display="none",selectedMerchantRequest=null},300)}async function updateRequestStatus(e){selectedMerchantRequest&&("pending"===selectedMerchantRequest.status?"rejected"!==e?await performStatusUpdate(e):openRejectionModal():showNotification("Doar companiile în așteptare pot fi modificate.","info"))}function openRejectionModal(){if(!selectedMerchantRequest||"pending"!==selectedMerchantRequest.status)return void showNotification("Doar companiile în așteptare pot fi respinse.","info");const e=document.getElementById("rejectionModal");e.style.display="flex",setTimeout(()=>e.classList.add("show"),10)}function closeRejectionModal(){const e=document.getElementById("rejectionModal");e.classList.remove("show"),setTimeout(()=>{e.style.display="none",document.getElementById("rejectionReason").value=""},300)}function confirmRejection(){const e=document.getElementById("rejectionReason").value.trim();e?(performStatusUpdate("rejected",e),closeRejectionModal()):showNotification("Te rugăm să specifici motivul respingerii.","error")}async function performStatusUpdate(e,t=null){if(selectedMerchantRequest)try{const t=document.getElementById("approveBtn"),n=document.getElementById("rejectBtn");t&&(t.disabled=!0),n&&(n.disabled=!0);const s={isActive:"approved"===e},a=await fetch(`${API_BASE_URL}/companies/${selectedMerchantRequest.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(s)});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);selectedMerchantRequest.status=e,selectedMerchantRequest.isActive="approved"===e,"approved"===e&&(selectedMerchantRequest.approvedAt=(new Date).toISOString(),selectedMerchantRequest.approvedBy="admin@acoomh.ro");const i=allMerchantRequests.findIndex(e=>e.id===selectedMerchantRequest.id);-1!==i&&(allMerchantRequests[i]={...selectedMerchantRequest}),updateStatistics(),applyFilters(),closeMerchantModal();showNotification(`Compania a fost ${"approved"===e?"aprobată":"respinsă"} cu succes.`,"success")}catch(e){console.error("Error updating company status:",e),showNotification("Eroare la actualizarea statusului companiei.","error");const t=document.getElementById("approveBtn"),n=document.getElementById("rejectBtn");t&&(t.disabled=!1),n&&(n.disabled=!1)}}function downloadDocument(e){showNotification(`Funcția de descărcare nu este disponibilă: ${e}`,"info"),console.log("Download document:",e)}function showNotification(e,t="info"){const n=document.createElement("div");n.style.cssText=`\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    background: ${"success"===t?"var(--success-color)":"error"===t?"var(--error-color)":"var(--info-color)"};\n    color: white;\n    padding: 15px 20px;\n    border-radius: 10px;\n    font-weight: 600;\n    z-index: 10000;\n    transform: translateX(400px);\n    transition: transform 0.3s ease;\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n    max-width: 300px;\n  `,n.textContent=e,document.body.appendChild(n),setTimeout(()=>{n.style.transform="translateX(0)"},100),setTimeout(()=>{n.style.transform="translateX(400px)",setTimeout(()=>{document.body.contains(n)&&document.body.removeChild(n)},300)},4e3)}function setupNavigation(){document.querySelectorAll('a[href*=".html"]').forEach(e=>{e.addEventListener("click",function(e){const t=this.getAttribute("href");!t||!t.includes(".html")||t.startsWith("http")||t.startsWith("mailto")||t.startsWith("tel")||(e.preventDefault(),navigateWithLoading(t))})})}function createLoadingOverlay(){const e=document.createElement("div");return e.className="page-loading-overlay",e.id="pageLoadingOverlay",e.innerHTML='\n    <div class="loading-spinner-container">\n      <div class="modern-loading-spinner"></div>\n      <div class="loading-text">\n        Se încarcă<span class="loading-dots"></span>\n      </div>\n    </div>\n  ',document.body.appendChild(e),e}function showLoadingOverlay(){document.body.classList.add("loading"),document.body.classList.remove("loaded");let e=document.getElementById("pageLoadingOverlay");e||(e=createLoadingOverlay()),e.classList.remove("hidden")}function hideLoadingOverlay(){const e=document.getElementById("pageLoadingOverlay");e&&(e.classList.add("hidden"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},500)),document.body.classList.remove("loading"),document.body.classList.add("loaded")}function navigateWithLoading(e){clearTimeout(window.loadingTimeout),showLoadingOverlay(),window.location.href=e}document.addEventListener("DOMContentLoaded",function(){try{initializeFilters(),initializeSearch(),loadMerchantRequests(),setTimeout(()=>{hideLoadingOverlay()},800),setupNavigation()}catch(e){console.error("Merchant requests page initialization error:",e),hideLoadingOverlay()}}),document.addEventListener("visibilitychange",function(){document.hidden||setTimeout(()=>{const e=document.getElementById("pageLoadingOverlay");e&&!e.classList.contains("hidden")&&hideLoadingOverlay()},100)}),window.addEventListener("pageshow",function(e){e.persisted&&hideLoadingOverlay()}),window.addEventListener("beforeunload",function(){showLoadingOverlay()}),window.loadMerchantRequests=loadMerchantRequests,window.closeMerchantModal=closeMerchantModal,window.closeRejectionModal=closeRejectionModal,window.updateRequestStatus=updateRequestStatus,window.confirmRejection=confirmRejection,window.downloadDocument=downloadDocument;